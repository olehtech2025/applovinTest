<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <meta
            http-equiv="Content-Security-Policy"
            content="
      default-src * data: blob: 'unsafe-inline' 'unsafe-eval';
      script-src * data: blob: 'unsafe-inline' 'unsafe-eval';
      style-src * 'unsafe-inline';
      img-src * data: blob:;
      media-src *;
    "
    />

    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
    <link rel="stylesheet" href="css/index.css">
    <title>Cordova App</title>
</head>

<body>
<div class="app">
    <h1>Apache Cordova</h1>
    <div id="deviceready" class="blink">
        <p class="event listening">Connecting to Device</p>
        <p class="event received">Device is Ready</p>
    </div>
</div>

<!-- Cordova -->
<script src="cordova.js"></script>

<!-- Mediator -->
<script src="AppLovinMediator.js"></script>

<script>
   // (function(u,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(u=typeof globalThis<"u"?globalThis:u||self,p(u.coreSDK={}))})(this,(function(u){"use strict";var p=typeof document<"u"?document.currentScript:null;const N={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function B(s){if(typeof process<"u"&&process.env){const e=process.env[s];if(e)return e}if(typeof{url:typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:p&&p.tagName.toUpperCase()==="SCRIPT"&&p.src||new URL("game-sdk.umd.js",document.baseURI).href}<"u"&&N){const e=N[s];if(e)return e}if(typeof window<"u"&&window.__ENV__){const e=window.__ENV__[s];if(e)return e}}const we=B("REACT_APP_BACKEND_URL"),ve=B("REACT_APP_BACKEND_URL_AUTH"),m={baseUrl:we,authUrl:ve};function G(s){m.baseUrl=s}function $(s){m.authUrl=s}const F="coreSDK_profiles_v1",be=100,H=300*1e3,Ae=600*1e3;class Ee{constructor(e){this.items=new Map,this.maxItems=e?.maxItems??be,this.loadFromStorage()}get(e){const t=this.items.get(e);if(!t)return null;const n=Date.now();return n-t.cachedAt>t.ttl?(this.items.delete(e),this.saveToStorageSafe(),null):(t.lastAccessed=n,t.profile)}set(e,t){const n=Date.now(),i={profile:e,cachedAt:n,lastAccessed:n,ttl:t};this.items.set(e.gid,i),this.evictIfNeeded(),this.saveToStorageSafe()}invalidate(e){this.items.delete(e)&&this.saveToStorageSafe()}invalidateAll(){this.items.clear(),this.saveToStorageSafe()}evictIfNeeded(){if(this.items.size<=this.maxItems)return;const e=Array.from(this.items.entries());e.sort((n,i)=>n[1].lastAccessed-i[1].lastAccessed);const t=e.length-this.maxItems;for(let n=0;n<t;n++){const[i]=e[n];this.items.delete(i)}}loadFromStorage(){if(!(typeof localStorage>"u"))try{const e=localStorage.getItem(F);if(!e)return;const t=JSON.parse(e);if(t.version!==1||!t.items||typeof t.items!="object")return;const n=Date.now();for(const[i,r]of Object.entries(t.items))!r||!r.profile||typeof r.cachedAt!="number"||typeof r.ttl!="number"||n-r.cachedAt>r.ttl||this.items.set(i,r);this.evictIfNeeded()}catch(e){console.error("[ProfileCache] loadFromStorage error:",e)}}saveToStorageSafe(){if(!(typeof localStorage>"u"))try{const e={};for(const[n,i]of this.items.entries())e[n]=i;const t={version:1,items:e};localStorage.setItem(F,JSON.stringify(t))}catch(e){console.error("[ProfileCache] saveToStorageSafe error:",e)}}}const I={PROFILE_UPDATED:"profile.updated"};class q{constructor(e,t){this.cache=new Ee,this.meGid=null,this.getAuthToken=e,this.events=t}buildUrl(e){const t=m.authUrl.replace(/\/+$/,""),n=e.replace(/^\/+/,"");return`${t}/${n}`}async request(e,t={}){const n=this.buildUrl(e),i=this.getAuthToken(),r={"Content-Type":"application/json",...t.headers};i&&(r.Authorization=`Bearer ${i}`);const a=await fetch(n,{...t,headers:r,credentials:"include"});if(!a.ok){const l=await a.text();let d=`Request failed with status ${a.status}`;try{const c=JSON.parse(l);Array.isArray(c.message)?d=c.message.join(", "):c.message?d=c.message:c.error&&(d=c.error)}catch{}throw new Error(d)}const o=await a.text();return o?JSON.parse(o):null}async getMe(){if(this.meGid){const t=this.cache.get(this.meGid);if(t)return t}const e=await this.request("/v1/profile/me");return this.meGid=e.gid,this.cache.set(e,H),e}async getByGid(e){if(this.meGid===e)return this.getMe();const t=this.cache.get(e);if(t)return t;const n=await this.request(`/v1/profile/${e}`);return this.cache.set(n,Ae),n}async update(e){const t=await this.request("/v1/profile/me",{method:"PUT",body:JSON.stringify(e)});return this.meGid=t.gid,this.cache.set(t,H),this.events.emit(I.PROFILE_UPDATED,{gid:t.gid,profile:t}),typeof window<"u"&&window.dispatchEvent(new CustomEvent(I.PROFILE_UPDATED,{detail:{gid:t.gid,profile:t}})),t}async getSummary(e){let t=e;return t||(t=(await this.getMe()).gid),this.request(`/v1/profile/${t}/summary`)}async getSummaryBatch(e){return(await this.request("/v1/profile/batch",{method:"POST",body:JSON.stringify({gids:e})})).profiles??[]}invalidate(e){this.cache.invalidate(e)}invalidateAll(){this.cache.invalidateAll()}}class x{constructor(e){this.getAuthToken=e}buildUrl(e){const t=m.baseUrl.replace(/\/+$/,""),n=e.replace(/^\/+/,"");return`${t}/${n}`}async request(e,t={}){const n=this.buildUrl(e),i=this.getAuthToken(),r={"Content-Type":"application/json",...t.headers};i&&(r.Authorization=`Bearer ${i}`),console.log("[API] REQUEST:",{url:n,method:t.method??"GET",headers:r,body:t.body});const a=await fetch(n,{...t,headers:r,credentials:"include"});if(!a.ok){const l=await a.text().catch(()=>"");throw console.error("[API] Request failed:",{url:n,status:a.status,body:l}),new Error(`Request failed with status ${a.status}`)}const o=await a.text();if(!o)return null;try{return JSON.parse(o)}catch(l){return console.warn("[API] Response is not JSON, returning as text:",l),o}}normalizeBody(e){return e===void 0?void 0:JSON.stringify(e)}send(e,t,n){return this.request(t,{method:e,body:this.normalizeBody(n)})}get(e){return this.send("GET",e)}post(e,t){return this.send("POST",e,t)}put(e,t){return this.send("PUT",e,t)}patch(e,t){return this.send("PATCH",e,t)}delete(e){return this.send("DELETE",e)}}class J{constructor(){this.listeners=new Map,this.onceListeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}once(e,t){this.onceListeners.has(e)||this.onceListeners.set(e,new Set),this.onceListeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t),this.onceListeners.get(e)?.delete(t)}emit(e,...t){this.listeners.get(e)?.forEach(i=>i(...t));const n=this.onceListeners.get(e);n&&(n.forEach(i=>i(...t)),this.onceListeners.delete(e))}}const v=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,g=globalThis,A="10.27.0";function j(){return O(g),g}function O(s){const e=s.__SENTRY__=s.__SENTRY__||{};return e.version=e.version||A,e[A]=e[A]||{}}function R(s,e,t=g){const n=t.__SENTRY__=t.__SENTRY__||{},i=n[A]=n[A]||{};return i[s]||(i[s]=e())}const Ce="Sentry Logger ",V={};function Te(s){if(!("console"in g))return s();const e=g.console,t={},n=Object.keys(V);n.forEach(i=>{const r=V[i];t[i]=e[i],e[i]=r});try{return s()}finally{n.forEach(i=>{e[i]=t[i]})}}function Pe(){U().enabled=!0}function De(){U().enabled=!1}function z(){return U().enabled}function Ie(...s){k("log",...s)}function Oe(...s){k("warn",...s)}function Re(...s){k("error",...s)}function k(s,...e){v&&z()&&Te(()=>{g.console[s](`${Ce}[${s}]:`,...e)})}function U(){return v?R("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const T={enable:Pe,disable:De,isEnabled:z,log:Ie,warn:Oe,error:Re},ke=Object.prototype.toString;function Ue(s,e){return ke.call(s)===`[object ${e}]`}function Le(s){return Ue(s,"Object")}function Me(s){return!!(s?.then&&typeof s.then=="function")}function Ke(s,e,t){try{Object.defineProperty(s,e,{value:t,writable:!0,configurable:!0})}catch{v&&T.log(`Failed to add non-enumerable property "${e}" to object`,s)}}function Ne(s,e=0){return typeof s!="string"||e===0||s.length<=e?s:`${s.slice(0,e)}...`}function Be(){const s=g;return s.crypto||s.msCrypto}let L;function Ge(){return Math.random()*16}function E(s=Be()){try{if(s?.randomUUID)return s.randomUUID().replace(/-/g,"")}catch{}return L||(L="10000000100040008000"+1e11),L.replace(/[018]/g,e=>(e^(Ge()&15)>>e/4).toString(16))}const W=1e3;function Y(){return Date.now()/W}function $e(){const{performance:s}=g;if(!s?.now||!s.timeOrigin)return Y;const e=s.timeOrigin;return()=>(e+s.now())/W}let X;function Fe(){return(X??(X=$e()))()}function He(s,e={}){if(e.user&&(!s.ipAddress&&e.user.ip_address&&(s.ipAddress=e.user.ip_address),!s.did&&!e.did&&(s.did=e.user.id||e.user.email||e.user.username)),s.timestamp=e.timestamp||Fe(),e.abnormal_mechanism&&(s.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(s.ignoreDuration=e.ignoreDuration),e.sid&&(s.sid=e.sid.length===32?e.sid:E()),e.init!==void 0&&(s.init=e.init),!s.did&&e.did&&(s.did=`${e.did}`),typeof e.started=="number"&&(s.started=e.started),s.ignoreDuration)s.duration=void 0;else if(typeof e.duration=="number")s.duration=e.duration;else{const t=s.timestamp-s.started;s.duration=t>=0?t:0}e.release&&(s.release=e.release),e.environment&&(s.environment=e.environment),!s.ipAddress&&e.ipAddress&&(s.ipAddress=e.ipAddress),!s.userAgent&&e.userAgent&&(s.userAgent=e.userAgent),typeof e.errors=="number"&&(s.errors=e.errors),e.status&&(s.status=e.status)}function Q(s,e,t=2){if(!e||typeof e!="object"||t<=0)return e;if(s&&Object.keys(e).length===0)return s;const n={...s};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=Q(n[i],e[i],t-1));return n}function Z(){return E()}const M="_sentrySpan";function ee(s,e){e?Ke(s,M,e):delete s[M]}function te(s){return s[M]}const qe=100;class S{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._attributes={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:Z(),sampleRand:Math.random()}}clone(){const e=new S;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._attributes={...this._attributes},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,ee(e,te(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&He(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this.setTags({[e]:t})}setAttributes(e){return this._attributes={...this._attributes,...e},this._notifyScopeListeners(),this}setAttribute(e,t){return this.setAttributes({[e]:t})}removeAttribute(e){return e in this._attributes&&(delete this._attributes[e],this._notifyScopeListeners()),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return t===null?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t=typeof e=="function"?e(this):e,n=t instanceof S?t.getScopeData():Le(t)?e:void 0,{tags:i,attributes:r,extra:a,user:o,contexts:l,level:d,fingerprint:c=[],propagationContext:h}=n||{};return this._tags={...this._tags,...i},this._attributes={...this._attributes,...r},this._extra={...this._extra,...a},this._contexts={...this._contexts,...l},o&&Object.keys(o).length&&(this._user=o),d&&(this._level=d),c.length&&(this._fingerprint=c),h&&(this._propagationContext=h),this}clear(){return this._breadcrumbs=[],this._tags={},this._attributes={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,ee(this,void 0),this._attachments=[],this.setPropagationContext({traceId:Z(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const n=typeof t=="number"?t:qe;if(n<=0)return this;const i={timestamp:Y(),...e,message:e.message?Ne(e.message,2048):e.message};return this._breadcrumbs.push(i),this._breadcrumbs.length>n&&(this._breadcrumbs=this._breadcrumbs.slice(-n),this._client?.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,attributes:this._attributes,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:te(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=Q(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const n=t?.event_id||E();if(!this._client)return v&&T.warn("No client configured on scope - will not capture exception!"),n;const i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...t,event_id:n},this),n}captureMessage(e,t,n){const i=n?.event_id||E();if(!this._client)return v&&T.warn("No client configured on scope - will not capture message!"),i;const r=n?.syntheticException??new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:r,...n,event_id:i},this),i}captureEvent(e,t){const n=t?.event_id||E();return this._client?(this._client.captureEvent(e,{...t,event_id:n},this),n):(v&&T.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}function xe(){return R("defaultCurrentScope",()=>new S)}function Je(){return R("defaultIsolationScope",()=>new S)}class je{constructor(e,t){let n;e?n=e:n=new S;let i;t?i=t:i=new S,this._stack=[{scope:n}],this._isolationScope=i}withScope(e){const t=this._pushScope();let n;try{n=e(t)}catch(i){throw this._popScope(),i}return Me(n)?n.then(i=>(this._popScope(),i),i=>{throw this._popScope(),i}):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function b(){const s=j(),e=O(s);return e.stack=e.stack||new je(xe(),Je())}function Ve(s){return b().withScope(s)}function ze(s,e){const t=b();return t.withScope(()=>(t.getStackTop().scope=s,e(s)))}function se(s){return b().withScope(()=>s(b().getIsolationScope()))}function We(){return{withIsolationScope:se,withScope:Ve,withSetScope:ze,withSetIsolationScope:(s,e)=>se(e),getCurrentScope:()=>b().getScope(),getIsolationScope:()=>b().getIsolationScope()}}function Ye(s){const e=O(s);return e.acs?e.acs:We()}function Xe(){const s=j();return Ye(s).getCurrentScope()}function _t(s){}function Qe(s,e){return Xe().captureException(s,void 0)}class ne{constructor(e){this.apiClient=e}async init(e){return this.apiClient.post("/v1/configs/init",e)}async fetch(e){return this.apiClient.post("/v1/configs/fetch",e)}}class ie{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/ab-tests")}async getActive(){return this.apiClient.get("/v1/ab-tests/active")}async getById(e){return this.apiClient.get(`/v1/ab-tests/${e}`)}async getVariant(e){return this.apiClient.get(`/v1/ab-tests/${e}/variant`)}async create(e){return this.apiClient.post("/v1/ab-tests",e)}async update(e,t){return this.apiClient.request(`/v1/ab-tests/${e}`,{method:"PUT",body:JSON.stringify(t)})}async patch(e,t){return this.apiClient.request(`/v1/ab-tests/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.apiClient.request(`/v1/ab-tests/${e}`,{method:"DELETE"})}}class re{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/remote-configs")}async getById(e){return this.apiClient.get(`/v1/remote-configs/${e}`)}async create(e){return this.apiClient.post("/v1/remote-configs",e)}async update(e,t){return this.apiClient.request(`/v1/remote-configs/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.apiClient.request(`/v1/remote-configs/${e}`,{method:"DELETE"})}async refresh(){return this.apiClient.post("/v1/remote-configs/refresh",{})}}class oe{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/segments")}async getById(e){return this.apiClient.get(`/v1/segments/${e}`)}async getUserSegments(){return this.apiClient.get("/v1/segments/user")}async create(e){return this.apiClient.post("/v1/segments",e)}async update(e,t){return this.apiClient.request(`/v1/segments/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.apiClient.request(`/v1/segments/${e}`,{method:"DELETE"})}}class ae{constructor(e){this.getAuthToken=e}buildUrl(e){const t=m.authUrl.replace(/\/+$/,""),n=e.replace(/^\/+/,"");return`${t}/${n}`}async request(e,t={}){const n=this.buildUrl(e),i=this.getAuthToken(),r={"Content-Type":"application/json",...t.headers};i&&(r.Authorization=`Bearer ${i}`);const a=await fetch(n,{...t,headers:r,credentials:"include"});if(!a.ok){const l=await a.text();let d=`Request failed with status ${a.status}`;try{const c=JSON.parse(l);Array.isArray(c.message)?d=c.message.join(", "):c.message?d=c.message:c.error&&(d=c.error)}catch{}throw new Error(d)}const o=await a.text();return o?JSON.parse(o):null}async getAll(){return this.request("/v1/users")}async getById(e){return this.request(`/v1/users/${e}`)}async search(e){return this.request(`/v1/users/search?q=${encodeURIComponent(e)}`)}async create(e){return this.request("/v1/users",{method:"POST",body:JSON.stringify(e)})}async update(e,t){return this.request(`/v1/users/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.request(`/v1/users/${e}`,{method:"DELETE"})}}class ce{constructor(e){this.apiClient=e}async getVersion(){return this.apiClient.get("/v1")}async check(){return this.apiClient.get("/v1/health")}async detailed(){return this.apiClient.get("/v1/health/detailed")}}class ue{constructor(e){this.getAuthToken=e}buildUrl(e){const t=m.authUrl.replace(/\/+$/,""),n=e.replace(/^\/+/,"");return`${t}/${n}`}async request(e,t={}){const n=this.buildUrl(e),i=this.getAuthToken(),r={"Content-Type":"application/json",...t.headers};i&&(r.Authorization=`Bearer ${i}`);const a=await fetch(n,{...t,headers:r,credentials:"include"});if(!a.ok){const l=await a.text();let d=`Request failed with status ${a.status}`;try{const c=JSON.parse(l);Array.isArray(c.message)?d=c.message.join(", "):c.message?d=c.message:c.error&&(d=c.error)}catch(c){console.error("[AuthApiClient] Error parsing error response:",c,"Raw:",l)}throw console.error("[AuthApiClient] Request failed:",{url:n,status:a.status,message:d}),new Error(d)}const o=await a.text();if(!o)return null;try{return JSON.parse(o)}catch(l){return console.warn("[AuthApiClient] Response is not JSON, returning as text:",l),o}}async guest(e){return this.request("/v1/auth/guest",{method:"POST",body:JSON.stringify({deviceId:e})})}async login(e){return this.request("/v1/auth/login",{method:"POST",body:JSON.stringify(e)})}async register(e){return this.request("/v1/auth/registration",{method:"POST",body:JSON.stringify(e)})}async logout(){return this.request("/v1/auth/logout",{method:"POST"})}async getMe(){return this.request("/v1/auth/me",{method:"GET"})}async refresh(){return this.request("/v1/auth/refresh",{method:"POST"})}async googleLogin(e){return this.request("/v1/auth/google",{method:"POST",body:JSON.stringify({idToken:e})})}async health(){return this.request("/v1/health",{method:"GET"})}}class le{constructor(e){this.apiClient=e}async health(){return this.apiClient.get("/v1/kv/health")}async list(){return this.apiClient.get("/v1/kv/list")}async get(e){return this.apiClient.get(`/v1/kv/get/${encodeURIComponent(e)}`)}async set(e,t){const n={key:e,value:t};return this.apiClient.post("/v1/kv/set",n)}async delete(e){return this.apiClient.delete(`/v1/kv/${encodeURIComponent(e)}`)}async exists(e){try{return await this.get(e),!0}catch(t){return console.debug("[KVApiClient] exists check failed for key:",e,t),!1}}async getMany(e){const t={},n=e.map(async i=>{try{const r=await this.get(i);t[i]=r.value}catch(r){console.debug("[KVApiClient] getMany failed for key:",i,r),t[i]=null}});return await Promise.all(n),t}async setMany(e){const t=Object.entries(e).map(([n,i])=>this.set(n,i));await Promise.all(t)}async deleteMany(e){const t=e.map(n=>this.delete(n));await Promise.all(t)}}class Ze{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/events")}async send(e){return this.apiClient.post("/v1/events",e)}}const P="1.0.25",D=[P,"1.0.3","1.0.0"];function de(s){return D.includes(s)}function he(s){if(!de(s)){const e=D.join(", ");throw new Error(`[SDK] Unsupported version "${s}". Supported versions: ${e}. Current SDK version: ${P}`)}}const fe=()=>typeof window<"u"&&typeof navigator<"u",et=()=>fe()&&navigator.userAgent||"",tt=s=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(s),st=()=>{if(!fe())return{env:"unknown"};const s=window,e=et(),t=s?.cordova,n=typeof t?.platformId=="string"?t.platformId:void 0;return t?n==="ios"?{env:"cordova-ios",platformId:n,userAgent:e}:n==="android"?{env:"cordova-android",platformId:n,userAgent:e}:{env:"unknown",platformId:n,userAgent:e}:{env:tt(e)?"web-mobile":"web-desktop",userAgent:e}},ge=s=>{const e=s?.get?.("ads")??null;if(!e||typeof e!="object")return null;const t=!!e.enabled,n=e.placements;return!n||typeof n!="object"?null:{enabled:t,defaults:e.defaults,mediators:e.mediators,placements:n}},pe=s=>s==="cordova-ios"||s==="cordova-android"?"cordova":s==="web-mobile"||s==="web-desktop"?"web":null,nt=(s,e)=>({placement:s,type:e,isReady:!1,isLoading:!1,readyTime:null,lastLoadStartTime:null,lastShowTime:null,retryCount:0,lastErrorCode:null,lastErrorMessage:null,stats:{totalLoads:0,successfulLoads:0,totalShows:0,totalRewards:0}}),it=(s,e,t)=>s==="linear"?t*e:s==="exponential"?t*Math.pow(2,e-1):0,rt=(s,e,t)=>{let n;return Promise.race([s,new Promise((i,r)=>{n=setTimeout(()=>r(t),e)})]).finally(()=>clearTimeout(n))},ot=(s,e)=>{if(s.isReady)return Promise.resolve(!0);const t=Date.now();return new Promise(n=>{const i=()=>{if(s.isReady)return n(!0);if(Date.now()-t>=e)return n(!1);setTimeout(i,100)};i()})},me={},at=(s,e)=>{me[s]=e},ct=s=>me[s]?.(),Se=s=>{try{return JSON.stringify(s??{})}catch{return""}};class ut{constructor(e){this.deps=e,this.enabled=!1,this.mediators=new Map,this.environment="unknown",this.placements=new Map,this.showingPlacement=null,this.adsConfig=null,this.mediatorsConfigHash=null,this.mediatorInitPromises=new Map;const t=e.eventBus;t&&(typeof t.emit=="function"&&(t.emit=t.emit.bind(t)),typeof t.on=="function"&&(t.on=t.on.bind(t)),typeof t.once=="function"&&(t.once=t.once.bind(t)),typeof t.off=="function"&&(t.off=t.off.bind(t)))}async init(){const{env:e,platformId:t,userAgent:n}=st();this.environment=e,this.deps.logger?.info?.("[AdManager] init start",{env:e,platformId:t,userAgent:n}),this.deps.eventBus?.emit?.("ads.init.start",{env:e});const i=ge(this.deps.configService);if(this.adsConfig=i,!i){this.enabled=!1,this.deps.logger?.warn?.("[AdManager] ads config missing"),this.deps.eventBus?.emit?.("ads.init.failed",{env:e,reason:"NO_CONFIG"});return}if(!i.enabled){this.enabled=!1,this.deps.logger?.info?.("[AdManager] ads disabled by config");return}const r=pe(this.environment);if(!r){this.enabled=!1,this.deps.logger?.warn?.("[AdManager] unknown environment branch",{env:this.environment}),this.deps.eventBus?.emit?.("ads.init.failed",{env:e,reason:"UNKNOWN_ENV"});return}this.mediatorsConfigHash=Se(i.mediators),this.enabled=!0,this.deps.logger?.info?.("[AdManager] ads enabled",{env:e,branch:r}),this.deps.eventBus?.emit?.("ads.init.success",{env:e,branch:r}),this.deps.eventBus?.on?.("config.updated",()=>{this.onConfigUpdated()});for(const[a,o]of Object.entries(i.placements))this.getPlacementState(a,o.type);if(i.defaults?.preloadOnStart)for(const[a,o]of Object.entries(i.placements))this.preloadPlacement(a,o).catch(l=>{this.deps.logger?.warn?.("[AdManager] preload failed",{placement:a,err:l})})}onConfigUpdated(){const e=ge(this.deps.configService);if(!e)return;const t=Se(e.mediators);if(this.mediatorsConfigHash!==t){this.deps.logger?.info?.("[AdManager] mediators config changed, resetting");for(const n of this.mediators.values())n.destroy?.();this.mediators.clear(),this.mediatorsConfigHash=t}this.adsConfig=e,this.mediatorInitPromises.clear();for(const n of this.placements.keys())e.placements[n]||this.placements.delete(n)}async getMediatorForPlacement(e,t){const n=pe(this.environment);if(!n)return null;const r=t?.[n]?.mediator;if(!r)return null;let a=this.mediators.get(r);if(a)return a;let o=this.mediatorInitPromises.get(r);return o||(o=(async()=>{const l=ct(r);if(!l)throw new Error("MEDIATOR_NOT_REGISTERED");return await l.init(this.adsConfig,this.environment),this.mediators.set(r,l),this.mediatorInitPromises.delete(r),l})(),this.mediatorInitPromises.set(r,o)),o}async showAd(e,t,n){const i=Date.now(),r=this.adsConfig,a=r?.placements?.[t];if(console.group(`[ADS][showAd] ${t} (${e})`),console.log("[ADS] enabled:",this.enabled),console.log("[ADS] adsConfig:",r),console.log("[ADS] placementConfig:",a),!r||!this.enabled){const h={status:"SDK_DISABLED",type:e,placement:t,canReward:!1,timestamp:i};return console.warn("[ADS] SDK disabled"),n?.(h),console.groupEnd(),h}if(!a||a.type!==e){const h={status:"NO_CONFIG",type:e,placement:t,canReward:!1,timestamp:i};return console.warn("[ADS] NO_CONFIG for placement"),n?.(h),console.groupEnd(),h}let o=await this.getMediatorForPlacement(t,a);if(console.group("[ADS][DEBUG] mediator raw"),console.log("mediator:",o),console.log("typeof:",typeof o),console.groupEnd(),typeof o=="function"&&(console.warn("[ADS][DEBUG] mediator is function → invoking"),o=o()),o instanceof Promise&&(console.warn("[ADS][DEBUG] mediator is Promise → awaiting"),o=await o),console.group("[ADS][DEBUG] mediator resolved"),console.log("mediator:",o),console.log("typeof:",typeof o),console.log("keys:",o?Object.keys(o):null),console.log("has init:",typeof o?.init),console.log("has load:",typeof o?.load),console.log("has show:",typeof o?.show),console.log("proto:",o?Object.getPrototypeOf(o):null),console.groupEnd(),!o||typeof o.show!="function"){const h={status:"INTERNAL_ERROR",type:e,placement:t,canReward:!1,errorMessage:"Mediator.show is not a function",timestamp:Date.now()};return console.error("[ADS][FATAL] mediator.show missing",o),n?.(h),console.groupEnd(),h}if(this.showingPlacement){const h={status:"SHOW_FAILED",type:e,placement:t,canReward:!1,errorMessage:"Ad already showing",timestamp:i};return console.warn("[ADS] Ad already showing"),n?.(h),console.groupEnd(),h}const l=this.getPlacementState(t,e),d=r?.defaults?.loadTimeoutMs??15e3;if(console.log("[ADS] state before show:",l),!l.isReady&&(console.warn("[ADS] not ready → preload"),this.preloadPlacement(t,a).catch(()=>{}),!await ot(l,d))){const w={status:"NOT_READY",type:e,placement:t,canReward:!1,errorCode:"LOAD_TIMEOUT",errorMessage:`Ad not ready after ${d}ms`,timestamp:Date.now()};return console.warn("[ADS] NOT_READY timeout"),n?.(w),console.groupEnd(),w}this.showingPlacement=t,l.lastShowTime=Date.now(),l.stats.totalShows++,console.log("[ADS] showingPlacement set:",t);const c=r?.defaults?.showTimeoutMs??15e3;return new Promise(h=>{let w=!1;const K=f=>{w||(w=!0,this.showingPlacement=null,e!=="banner"&&(l.isReady=!1),console.log("[ADS] finish:",f),n?.(f),h(f),this.preloadPlacement(t,a).catch(()=>{}),console.groupEnd())},_e=setTimeout(()=>{console.warn("[ADS] SHOW TIMEOUT"),K({status:"TIMEOUT",type:e,placement:t,canReward:!1,timestamp:Date.now()})},c);try{console.log("[ADS] calling mediator.show()"),o.show(e,t,a,f=>{clearTimeout(_e),console.log("[ADS] mediator result:",f),K({...f,type:e,placement:t,timestamp:Date.now()})})}catch(f){clearTimeout(_e),console.error("[ADS][ERROR] mediator.show exception",f),K({status:"INTERNAL_ERROR",type:e,placement:t,canReward:!1,errorMessage:String(f),timestamp:Date.now()})}})}getPlacementState(e,t){let n=this.placements.get(e);return n||(n=nt(e,t),this.placements.set(e,n)),n}async preloadPlacement(e,t){const n=this.getPlacementState(e,t.type),i=this.adsConfig;if(i&&!n.isReady)return n.isLoading&&n.loadPromise||(n.isLoading=!0,n.lastLoadStartTime=Date.now(),n.stats.totalLoads++,this.deps.eventBus?.emit?.("ads.placement.preload.start",{placement:e}),n.loadPromise=(async()=>{const r=i.defaults?.retry,a=r?.strategy??"none",o=r?.maxAttempts??0,l=r?.baseDelayMs??0,d=i.defaults?.loadTimeoutMs??15e3;for(;;)try{const c=await this.getMediatorForPlacement(e,t);if(!c)throw new Error("NO_MEDIATOR");await rt(c.load(t.type,e,t),d,new Error("LOAD_TIMEOUT")),n.isReady=!0,n.retryCount=0,n.readyTime=Date.now(),n.stats.successfulLoads++,this.deps.eventBus?.emit?.("ads.placement.preload.success",{placement:e});return}catch(c){if(n.retryCount++,n.lastErrorCode=c?.code??"LOAD_FAILED",n.lastErrorMessage=c?.message??"Ad load failed",this.deps.eventBus?.emit?.("ads.placement.preload.failed",{placement:e,errorCode:n.lastErrorCode,errorMessage:n.lastErrorMessage}),n.retryCount>o||a==="none")return;const h=it(a,n.retryCount,l);await new Promise(w=>setTimeout(w,h))}})().finally(()=>{n.isLoading=!1,n.loadPromise=null})),n.loadPromise}}class lt{constructor(){this.store=new Map}get(e){return this.store.has(e)?this.store.get(e):null}set(e,t){this.store.set(e,t)}replace(e){this.store.clear();for(const[t,n]of Object.entries(e))this.store.set(t,n)}}const C={AUTH_OPEN:"core:authWindowOpen",AUTH_CLOSE:"core:authWindowClose",AUTH_POPUP_SHOW:"core:authPopupShow",AUTH_POPUP_HIDE:"core:authPopupHide",AUTH_SUCCESS:"core:authSuccess"};class y{constructor(){this.eventBus=new J,this.systemParams={},this.initialized=!1,this.ads={registerMediator:at},this.detectEnvironment(),this.apiClient=new x(()=>this.systemParams.authToken),this.configs=new ne(this.apiClient),this.abTests=new ie(this.apiClient),this.remoteConfigs=new re(this.apiClient),this.segments=new oe(this.apiClient),this.users=new ae(()=>this.systemParams.authToken),this.health=new ce(this.apiClient),this.auth=new ue(()=>this.systemParams.authToken),this.kv=new le(this.apiClient),this.events=new Ze(this.apiClient),this.configStore=new lt,this.adManager=new ut({configService:this.configStore,eventBus:this.eventBus,logger:console})}static getInstance(){return y.instance||(y.instance=new y),y.instance}async init(e){if(console.log(`[SDK] v${P} init: start`,e),e?.version){console.log(`[SDK] init: validating app version "${e.version}"...`);try{he(e.version),console.log(`[SDK] init: app version "${e.version}" is supported`)}catch(n){throw console.error(`[SDK] init: VERSION ERROR - ${n.message}`),console.error(`[SDK] init: Supported versions: ${D.join(", ")}`),n}}const t=this.getStoredToken();if(t&&!this.systemParams.authToken&&(console.log("[SDK] init: RESTORING TOKEN FROM LOCALSTORAGE"),this.systemParams.authToken=t),this.systemParams.authToken){console.log("[SDK] init: TOKEN ALREADY SET → SKIP GUEST AUTH"),this.profileClient=new q(()=>this.systemParams.authToken,this.eventBus),this.initialized=!0,e?.authPopup&&console.log("[SDK] init: authPopup=true, but already authenticated");return}if(!this.initialized)try{e?.baseUrl&&(console.log("[SDK] init: set base url ->",e.baseUrl),G(e.baseUrl)),e?.authUrl&&(console.log("[SDK] init: set auth url ->",e.authUrl),$(e.authUrl)),console.log("[SDK] init: set system params ->",e),e&&this.setSystemParams(e),console.log("[SDK] init: ensure device id…");const n=await this.ensureDeviceId();if(console.log("[SDK] init: deviceId =",n),this.systemParams.deviceId=n,e?.authPopup?console.log("[SDK] init: authPopup=true, skipping auto guest auth, will show popup"):e?.skipAuth?console.log("[SDK] init: skipAuth=true, skipping guest auth"):(console.log("[SDK] init: guest auth…"),await this.authGuest(),console.log("[SDK] init: guest auth OK")),this.profileClient=new q(()=>this.systemParams.authToken,this.eventBus),console.log("[SDK] init: profile module initialized"),this.on(I.PROFILE_UPDATED,i=>{try{const r=i?.gid??i?.detail?.gid;r&&(console.log("[SDK] profile cache invalidated for",r),this.profileClient.invalidate(r))}catch(r){console.error("[SDK] profile cache invalidation error:",r)}}),this.initialized=!0,console.log("[SDK] init: COMPLETE"),await this.initAds(),this.eventBus.emit("core:initialized",this.getSystemParams()),e?.authPopup){console.log("[SDK] init: authPopup=true, isAuthenticated =",this.isAuthenticated()),console.log("[SDK] init: authToken =",this.systemParams.authToken);const i=this.showAuthPopupIfNeeded();console.log("[SDK] init: popup shown =",i)}}catch(n){throw console.error("[SDK] init: ERROR",n),this.captureError(n),n}}captureError(e){try{Qe(e)}catch(t){console.error("[SDK] Sentry capture error:",t)}}async authGuest(){try{console.log("[SDK] authGuest: start");const e=this.getStoredToken();if(e){this.systemParams.authToken=e;return}console.log("[SDK] authGuest: sending POST /v1/auth/guest",{deviceId:this.systemParams.deviceId});const t=await this.auth.guest(this.systemParams.deviceId);console.log("[SDK] authGuest: server response",t);const n=t?.accessToken??t?.data?.accessToken??null;if(!n)throw console.error("[SDK] authGuest: ERROR missing token",t),new Error("Guest auth failed: missing token");this.storeToken(n),this.systemParams.authToken=n}catch(e){throw console.error("[SDK] authGuest: ERROR",e),this.captureError(e),e}}setSystemParams(e){this.systemParams={...this.systemParams,...e}}getSystemParams(){return{...this.systemParams}}get api(){return this.apiClient}on(e,t){this.eventBus.on(e,t)}once(e,t){this.eventBus.once(e,t)}off(e,t){this.eventBus.off(e,t)}emit(e,...t){this.eventBus.emit(e,...t)}detectEnvironment(){const e=typeof navigator<"u"?navigator.userAgent:"",t=typeof window<"u"&&typeof window.cordova<"u";this.systemParams.os=this.detectOS(e),this.systemParams.isCordova=t}detectOS(e){return/android/i.test(e)?"android":/iPad|iPhone|iPod/i.test(e)?"ios":/Win/i.test(e)?"windows":/Mac/i.test(e)?"macos":/Linux/i.test(e)?"linux":"unknown"}async ensureDeviceId(){const e=this.getStoredDeviceId();if(e)return e;const t=await this.tryGetCordovaDeviceId();if(t)return this.storeDeviceId(t),t;const n=this.generateGuid();return this.storeDeviceId(n),n}getStoredDeviceId(){try{return localStorage.getItem("coreSDK_deviceId")}catch(e){return console.error("[SDK] getStoredDeviceId error:",e),null}}storeDeviceId(e){try{localStorage.setItem("coreSDK_deviceId",e)}catch(t){console.error("[SDK] storeDeviceId error:",t)}}getStoredToken(){try{return localStorage.getItem("coreSDK_token")}catch(e){return console.error("[SDK] getStoredToken error:",e),null}}storeToken(e){try{localStorage.setItem("coreSDK_token",e)}catch(t){console.error("[SDK] storeToken error:",t)}}setUser(e){this.systemParams.user=e}async login(e){try{console.log("[SDK] login: start",{email:e.email});const t=await this.auth.login(e);console.log("[SDK] login: server response received");const n=t?.accessToken??null;if(!n)throw console.error("[SDK] login: ERROR missing token",t),new Error("Login failed: missing token");return this.storeToken(n),this.systemParams.authToken=n,t.user&&this.setUser(t.user),t}catch(t){throw console.error("[SDK] login: ERROR",t),this.captureError(t),t}}async register(e){try{console.log("[SDK] register: start",{email:e.email,username:e.username});const t=await this.auth.register(e);if(console.log("[SDK] register: server response received"),!t)throw console.error("[SDK] register: ERROR missing user data"),new Error("Registration failed: missing user data");return t}catch(t){throw console.error("[SDK] register: ERROR",t),this.captureError(t),t}}async logout(){try{console.log("[SDK] logout: start");try{await this.auth.logout()}catch(e){console.warn("[SDK] logout endpoint error (ignored):",e)}this.clearToken(),this.systemParams.authToken=void 0,this.systemParams.user=null,console.log("[SDK] logout: COMPLETE")}catch(e){throw console.error("[SDK] logout: ERROR",e),this.captureError(e),e}}clearToken(){try{localStorage.removeItem("coreSDK_token")}catch(e){console.error("[SDK] clearToken error:",e)}}async tryGetCordovaDeviceId(){if(typeof window>"u")return null;const e=window;return e.device?.uuid?String(e.device.uuid):null}generateGuid(){const e=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return`${e()}${e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`}get profile(){return this.profileClient}isAuthenticated(){return!!this.systemParams.authToken}showAuthPopupIfNeeded(){return this.isAuthenticated()?!1:(this.showAuthPopup(),!0)}showAuthPopup(){console.log("[SDK] showAuthPopup: emitting event"),this.eventBus.emit(C.AUTH_POPUP_SHOW)}hideAuthPopup(){console.log("[SDK] hideAuthPopup: emitting event"),this.eventBus.emit(C.AUTH_POPUP_HIDE)}async loginAsGuest(){try{console.log("[SDK] loginAsGuest: start"),await this.ensureDeviceId(),await this.authGuest(),this.hideAuthPopup(),this.eventBus.emit(C.AUTH_SUCCESS,{type:"guest"}),console.log("[SDK] loginAsGuest: SUCCESS")}catch(e){throw console.error("[SDK] loginAsGuest: ERROR",e),e}}async loginWithGoogle(e){try{console.log("[SDK] loginWithGoogle: start");const t=await this.auth.googleLogin(e),n=t?.accessToken??null;if(!n)throw new Error("Google login failed: missing token");this.storeToken(n),this.systemParams.authToken=n,t.user&&this.setUser(t.user),this.hideAuthPopup(),this.eventBus.emit(C.AUTH_SUCCESS,{type:"google"}),console.log("[SDK] loginWithGoogle: SUCCESS")}catch(t){throw console.error("[SDK] loginWithGoogle: ERROR",t),t}}showAd(e,t,n){return this.adManager.showAd(e,t,n)}async initAds(){await this.adManager.init()}__setConfigForTests(e,t){this.configStore.set(e,t)}}const dt=s=>Object.freeze({init:s.init.bind(s),initAds:s.initAds.bind(s),showAd:s.showAd.bind(s),getSystemParams:s.getSystemParams.bind(s),isAuthenticated:s.isAuthenticated.bind(s),on:s.on.bind(s),off:s.off.bind(s),configs:{init:s.configs.init.bind(s.configs),fetch:s.configs.fetch.bind(s.configs)},kv:{list:()=>s.kv.list()},ads:{registerMediator:s.ads.registerMediator.bind(s.ads)},__setConfigForTests:s.__setConfigForTests.bind(s)}),ht=y.getInstance(),ye=dt(ht),_=[{name:"core",description:"Core SDK methods",enabled:!0,methods:[{name:"init",description:"Initialize SDK",enabled:!0},{name:"getSystemParams",description:"Get system parameters",enabled:!0},{name:"setSystemParams",description:"Set system parameters",enabled:!0},{name:"isAuthenticated",description:"Check if user is authenticated",enabled:!0}]},{name:"auth",description:"Authentication methods",enabled:!0,methods:[{name:"login",description:"Login with email/password",enabled:!0},{name:"register",description:"Register new user",enabled:!0},{name:"logout",description:"Logout user",enabled:!0},{name:"authGuest",description:"Authenticate as guest",enabled:!0},{name:"loginAsGuest",description:"Login as guest (with popup)",enabled:!0},{name:"loginWithGoogle",description:"Login with Google",enabled:!0}]},{name:"authPopup",description:"Auth popup methods",enabled:!0,methods:[{name:"showAuthPopup",description:"Show auth popup",enabled:!0},{name:"hideAuthPopup",description:"Hide auth popup",enabled:!0},{name:"showAuthPopupIfNeeded",description:"Show popup if not authenticated",enabled:!0}]},{name:"events",description:"Event bus methods",enabled:!0,methods:[{name:"on",description:"Subscribe to event",enabled:!0},{name:"off",description:"Unsubscribe from event",enabled:!0},{name:"once",description:"Subscribe to event once",enabled:!0},{name:"emit",description:"Emit event",enabled:!0}]},{name:"profile",description:"User profile methods",enabled:!0,methods:[{name:"profile.get",description:"Get user profile",enabled:!0},{name:"profile.update",description:"Update user profile",enabled:!0},{name:"profile.invalidate",description:"Invalidate profile cache",enabled:!0}]},{name:"configs",description:"Configs API client",enabled:!0,methods:[{name:"configs.getAll",description:"Get all configs",enabled:!0},{name:"configs.get",description:"Get config by key",enabled:!0}]},{name:"abTests",description:"A/B Tests API client",enabled:!0,methods:[{name:"abTests.getAll",description:"Get all A/B tests",enabled:!0},{name:"abTests.get",description:"Get A/B test by id",enabled:!0},{name:"abTests.getVariant",description:"Get user variant",enabled:!0}]},{name:"remoteConfigs",description:"Remote Configs API client",enabled:!0,methods:[{name:"remoteConfigs.getAll",description:"Get all remote configs",enabled:!0},{name:"remoteConfigs.get",description:"Get remote config by key",enabled:!0}]},{name:"segments",description:"Segments API client",enabled:!0,methods:[{name:"segments.getAll",description:"Get all segments",enabled:!0},{name:"segments.check",description:"Check if user in segment",enabled:!0}]},{name:"users",description:"Users API client",enabled:!0,methods:[{name:"users.getMe",description:"Get current user",enabled:!0},{name:"users.update",description:"Update user data",enabled:!0}]},{name:"kv",description:"Key-Value storage API client",enabled:!0,methods:[{name:"kv.get",description:"Get value by key",enabled:!0},{name:"kv.set",description:"Set value by key",enabled:!0},{name:"kv.delete",description:"Delete value by key",enabled:!0},{name:"kv.exists",description:"Check if key exists",enabled:!0},{name:"kv.getMany",description:"Get multiple values",enabled:!0}]},{name:"health",description:"Health check API client",enabled:!0,methods:[{name:"health.check",description:"Check API health",enabled:!0}]},{name:"eventsApi",description:"Events API client (analytics)",enabled:!1,methods:[{name:"events.track",description:"Track event",enabled:!1},{name:"events.trackBatch",description:"Track batch of events",enabled:!1}]},{name:"ad",description:"Ad methods",enabled:!0,methods:[{name:"showAd",description:"Show ad for a placement",enabled:!0},{name:"initAds",description:"Initialize ads subsystem",enabled:!0},{name:"__setConfigForTests",description:"[DEV] Inject config directly into SDK",enabled:!0},{name:"__setAdsMediatorForTests",description:"[DEV] Inject ad mediator implementation",enabled:!0}]}];function ft(s){for(const e of _)if(e.enabled){for(const t of e.methods)if(t.name===s)return t.enabled}return!1}function gt(s){return _.find(t=>t.name===s)?.enabled??!1}function pt(){const s=[];for(const e of _)if(e.enabled)for(const t of e.methods)t.enabled&&s.push(t.name);return s}function mt(s){return _.find(t=>t.name===s)?.methods??[]}function St(s,e){for(const t of _)for(const n of t.methods)if(n.name===s){n.enabled=e;return}}function yt(s,e){const t=_.find(n=>n.name===s);t&&(t.enabled=e)}typeof window<"u"&&(window.coreSDK=ye),u.AbTestsApiClient=ie,u.ApiClient=x,u.AuthApiClient=ue,u.ConfigsApiClient=ne,u.CoreSDK=y,u.EventBus=J,u.HealthApiClient=ce,u.KVApiClient=le,u.RemoteConfigsApiClient=re,u.SDK_EVENTS=C,u.SDK_METHODS=_,u.SDK_VERSION=P,u.SUPPORTED_VERSIONS=D,u.SegmentsApiClient=oe,u.UsersApiClient=ae,u.coreSDK=ye,u.getEnabledMethods=pt,u.getMethodsByCategory=mt,u.isCategoryEnabled=gt,u.isMethodEnabled=ft,u.isVersionSupported=de,u.sdkConfig=m,u.setAuthUrl=$,u.setBaseUrl=G,u.setCategoryEnabled=yt,u.setMethodEnabled=St,u.validateVersion=he,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})}));

   (function(c,D){typeof exports=="object"&&typeof module<"u"?D(exports):typeof define=="function"&&define.amd?define(["exports"],D):(c=typeof globalThis<"u"?globalThis:c||self,D(c.coreSDK={}))})(this,(function(c){"use strict";const h={configUrl:"http://localhost:3000",authUrl:"http://localhost:3001",profileUrl:"http://localhost:3002"};function K(i){h.configUrl=i}function I(i){h.authUrl=i}function M(i){h.profileUrl=i}const q="coreSDK_profiles_v1",me=100,x=300*1e3;class ye{constructor(e){this.items=new Map,this.maxItems=e?.maxItems??me,this.loadFromStorage()}get(e){const t=this.items.get(e);if(!t)return null;const s=Date.now();return s-t.cachedAt>t.ttl?(this.items.delete(e),this.saveToStorageSafe(),null):(t.lastAccessed=s,t.profile)}set(e,t){const s=Date.now(),n={profile:e,cachedAt:s,lastAccessed:s,ttl:t};this.items.set(e.id,n),this.evictIfNeeded(),this.saveToStorageSafe()}invalidate(e){this.items.delete(e)&&this.saveToStorageSafe()}invalidateAll(){this.items.clear(),this.saveToStorageSafe()}evictIfNeeded(){if(this.items.size<=this.maxItems)return;const e=Array.from(this.items.entries());e.sort((s,n)=>s[1].lastAccessed-n[1].lastAccessed);const t=e.length-this.maxItems;for(let s=0;s<t;s++){const[n]=e[s];this.items.delete(n)}}loadFromStorage(){if(!(typeof localStorage>"u"))try{const e=localStorage.getItem(q);if(!e)return;const t=JSON.parse(e);if(t.version!==1||!t.items||typeof t.items!="object")return;const s=Date.now();for(const[n,r]of Object.entries(t.items))!r||!r.profile||typeof r.cachedAt!="number"||typeof r.ttl!="number"||s-r.cachedAt>r.ttl||this.items.set(n,r);this.evictIfNeeded()}catch(e){console.error("[ProfileCache] loadFromStorage error:",e)}}saveToStorageSafe(){if(!(typeof localStorage>"u"))try{const e={};for(const[s,n]of this.items.entries())e[s]=n;const t={version:1,items:e};localStorage.setItem(q,JSON.stringify(t))}catch(e){console.error("[ProfileCache] saveToStorageSafe error:",e)}}}const P={PROFILE_UPDATED:"profile.updated"};class C{constructor(e,t){this.cache=new ye,this.myProfileId=null,this.getAuthToken=e,this.events=t}buildUrl(e){const t=h.authUrl.replace(/\/+$/,""),s=e.replace(/^\/+/,"");return`${t}/${s}`}async request(e,t={}){const s=this.buildUrl(e);let n=this.getAuthToken();!n&&typeof localStorage<"u"&&(n=localStorage.getItem("coreSDK_token")||void 0);const r={"Content-Type":"application/json",...t.headers};n&&(r.Authorization=`Bearer ${n}`);const o=await fetch(s,{...t,headers:r,credentials:"include"});if(!o.ok){const u=await o.text();let d=`Request failed with status ${o.status}`;try{const l=JSON.parse(u);Array.isArray(l.message)?d=l.message.join(", "):l.message?d=l.message:l.error&&(d=l.error)}catch{}throw new Error(d)}const a=await o.text();return a?JSON.parse(a):null}emitUpdate(e){this.events.emit(P.PROFILE_UPDATED,{id:e.id,profile:e}),typeof window<"u"&&window.dispatchEvent(new CustomEvent(P.PROFILE_UPDATED,{detail:{id:e.id,profile:e}}))}async getProfile(){if(this.myProfileId){const t=this.cache.get(this.myProfileId);if(t)return t}const e=await this.request("/v1/auth/me");return this.myProfileId=e.id,this.cache.set(e,x),e}async getProfileField(e){return(await this.request(`/v1/profiles/me/field/${e}`)).value}async updateProfile(e){const t=await this.request("/v1/profiles/me",{method:"PATCH",body:JSON.stringify(e)});return this.myProfileId=t.id,this.cache.set(t,x),this.emitUpdate(t),t}async setProfileField(e,t){const s=await this.request(`/v1/profiles/me/field/${e}`,{method:"PUT",body:JSON.stringify({value:t})});return this.myProfileId&&this.cache.invalidate(this.myProfileId),s.value}async mergeProfileScope(e,t){const s=await this.request(`/v1/profiles/me/scope/${e}`,{method:"PATCH",body:JSON.stringify({data:t})});return this.myProfileId=s.id,this.cache.set(s,x),this.emitUpdate(s),s}invalidate(e){e?this.cache.invalidate(e):this.myProfileId&&this.cache.invalidate(this.myProfileId)}invalidateAll(){this.cache.invalidateAll()}resetMyProfileId(){this.myProfileId=null}}class F{constructor(e){this.getAuthToken=e}buildUrl(e){const t=h.configUrl.replace(/\/+$/,""),s=e.replace(/^\/+/,"");return`${t}/${s}`}async request(e,t={}){const s=this.buildUrl(e),n=this.getAuthToken(),r={"Content-Type":"application/json",...t.headers};n&&(r.Authorization=`Bearer ${n}`),console.log("[API] REQUEST:",{url:s,method:t.method??"GET",headers:r,body:t.body});const o=await fetch(s,{...t,headers:r,credentials:"include"});if(!o.ok){const u=await o.text().catch(()=>"");throw console.error("[API] Request failed:",{url:s,status:o.status,body:u}),new Error(`Request failed with status ${o.status}`)}const a=await o.text();if(!a)return null;try{return JSON.parse(a)}catch(u){return console.warn("[API] Response is not JSON, returning as text:",u),a}}normalizeBody(e){return e===void 0?void 0:JSON.stringify(e)}send(e,t,s){return this.request(t,{method:e,body:this.normalizeBody(s)})}get(e){return this.send("GET",e)}post(e,t){return this.send("POST",e,t)}put(e,t){return this.send("PUT",e,t)}patch(e,t){return this.send("PATCH",e,t)}delete(e){return this.send("DELETE",e)}}class J{constructor(){this.listeners=new Map,this.onceListeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}once(e,t){this.onceListeners.has(e)||this.onceListeners.set(e,new Set),this.onceListeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t),this.onceListeners.get(e)?.delete(t)}emit(e,...t){this.listeners.get(e)?.forEach(n=>n(...t));const s=this.onceListeners.get(e);s&&(s.forEach(n=>n(...t)),this.onceListeners.delete(e))}}const z="https://accounts.google.com/gsi/client",N=class N{static async loadScript(){if(typeof window>"u")throw new Error("GoogleAuthHelper requires browser environment");if(!window.google?.accounts?.id)return this.scriptLoading?this.scriptLoading:(this.scriptLoading=new Promise((e,t)=>{const s=document.querySelector(`script[src="${z}"]`);if(s){s.addEventListener("load",()=>e()),s.addEventListener("error",()=>t(new Error("Failed to load Google Sign-In")));return}const n=document.createElement("script");n.src=z,n.async=!0,n.defer=!0,n.onload=()=>e(),n.onerror=()=>t(new Error("Failed to load Google Sign-In")),document.head.appendChild(n)}),this.scriptLoading)}static requestToken(e,t){return new Promise((s,n)=>{if(!window.google?.accounts?.id){n(new Error("Google Identity Services not loaded"));return}window.google.accounts.id.initialize({client_id:e,callback:r=>{r.credential?s(r):n(new Error("No credential received from Google"))},auto_select:!1,cancel_on_tap_outside:!1}),t?.useOneTap?window.google.accounts.id.prompt(r=>{if(r.isNotDisplayed()||r.isSkippedMoment()){const o=r.isNotDisplayed()?r.getNotDisplayedReason():r.getSkippedReason();n(new Error(`Google One Tap unavailable: ${o}. Try without useOneTap option.`))}}):this.triggerButtonPopup(e,s,n)})}static triggerButtonPopup(e,t,s){const n=document.createElement("div");n.style.position="fixed",n.style.top="-9999px",n.style.left="-9999px",document.body.appendChild(n);let r=!1;const o=()=>{n.parentNode&&n.parentNode.removeChild(n)},a=setTimeout(()=>{r||(o(),s(new Error("Google Sign-In timeout or cancelled by user")))},12e4);window.google.accounts.id.initialize({client_id:e,callback:u=>{r=!0,clearTimeout(a),o(),u.credential?t(u):s(new Error("No credential received from Google"))}}),window.google.accounts.id.renderButton(n,{type:"standard",size:"large",click_listener:()=>{console.log("[GoogleAuthHelper] Button clicked, waiting for response...")}}),requestAnimationFrame(()=>{const u=n.querySelector("div[role='button']");if(u)u.click();else{const d=n.querySelector("*");d&&d.click()}})}static isAvailable(){return typeof window<"u"&&!!window.google?.accounts?.id}static cancel(){window.google?.accounts?.id&&window.google.accounts.id.cancel()}};N.scriptLoading=null;let v=N;class j{constructor(e){this.backdrop=null,this.options=e}show(){this.backdrop||(this.backdrop=document.createElement("div"),this.backdrop.className="coresdk-auth-backdrop",this.backdrop.innerHTML=this.getHTML(),this.injectStyles(),document.body.appendChild(this.backdrop),this.attachEvents())}hide(){this.backdrop&&(this.backdrop.remove(),this.backdrop=null)}getHTML(){return`
            <div class="coresdk-auth-modal">
                <h2 class="coresdk-auth-title">Choose Sign In Method</h2>
                <p class="coresdk-auth-subtitle">Select how you want to continue</p>

                <div class="coresdk-auth-buttons">
                    <button
                        class="coresdk-auth-btn coresdk-auth-btn-google"
                        data-action="google"
                        ${this.options.googleEnabled===!1?"disabled":""}
                    >
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        <span>Continue with Google</span>
                    </button>

                    <button class="coresdk-auth-btn coresdk-auth-btn-guest" data-action="guest">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                        <span>Continue as Guest</span>
                    </button>
                </div>

                <p class="coresdk-auth-hint">
                    Guest accounts are linked to this device
                </p>
            </div>
        `}injectStyles(){if(document.getElementById("coresdk-auth-styles"))return;const e=document.createElement("style");e.id="coresdk-auth-styles",e.textContent=`
            .coresdk-auth-backdrop {
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 999999;
                animation: coresdk-fadeIn 0.2s ease;
            }

            @keyframes coresdk-fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            @keyframes coresdk-slideUp {
                from {
                    opacity: 0;
                    transform: translateY(20px) scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            .coresdk-auth-modal {
                background: #fff;
                border-radius: 16px;
                padding: 32px;
                width: 340px;
                max-width: 90vw;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                animation: coresdk-slideUp 0.3s ease;
            }

            .coresdk-auth-title {
                margin: 0 0 8px;
                font-size: 22px;
                font-weight: 600;
                color: #1a1a1a;
                text-align: center;
                font-family: system-ui, -apple-system, sans-serif;
            }

            .coresdk-auth-subtitle {
                margin: 0 0 24px;
                font-size: 14px;
                color: #666;
                text-align: center;
                font-family: system-ui, -apple-system, sans-serif;
            }

            .coresdk-auth-buttons {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .coresdk-auth-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 12px;
                padding: 14px 20px;
                border-radius: 12px;
                font-size: 15px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s ease;
                border: none;
                font-family: system-ui, -apple-system, sans-serif;
            }

            .coresdk-auth-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .coresdk-auth-btn-google {
                background: #fff;
                border: 1px solid #ddd;
                color: #333;
            }

            .coresdk-auth-btn-google:hover:not(:disabled) {
                background: #f8f8f8;
                border-color: #ccc;
                transform: translateY(-1px);
            }

            .coresdk-auth-btn-guest {
                background: #333;
                color: #fff;
            }

            .coresdk-auth-btn-guest:hover:not(:disabled) {
                background: #444;
                transform: translateY(-1px);
            }

            .coresdk-auth-btn svg {
                flex-shrink: 0;
            }

            .coresdk-auth-hint {
                margin: 20px 0 0;
                font-size: 12px;
                color: #999;
                text-align: center;
                font-family: system-ui, -apple-system, sans-serif;
            }

            .coresdk-auth-btn.loading {
                pointer-events: none;
                opacity: 0.7;
            }

            .coresdk-auth-btn.loading span {
                opacity: 0.5;
            }
        `,document.head.appendChild(e)}attachEvents(){if(!this.backdrop)return;const e=this.backdrop.querySelector('[data-action="google"]'),t=this.backdrop.querySelector('[data-action="guest"]');e?.addEventListener("click",async()=>{if(!e.disabled){e.classList.add("loading");try{await this.options.onGoogleClick(),this.hide()}catch(s){console.error("[AuthModal] Google auth error:",s),e.classList.remove("loading")}}}),t?.addEventListener("click",async()=>{t.classList.add("loading");try{await this.options.onGuestClick(),this.hide()}catch(s){console.error("[AuthModal] Guest auth error:",s),t.classList.remove("loading")}}),this.backdrop.addEventListener("click",s=>{s.target===this.backdrop&&(this.hide(),this.options.onClose?.())})}}const y=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,g=globalThis,w="10.27.0";function H(){return U(g),g}function U(i){const e=i.__SENTRY__=i.__SENTRY__||{};return e.version=e.version||w,e[w]=e[w]||{}}function G(i,e,t=g){const s=t.__SENTRY__=t.__SENTRY__||{},n=s[w]=s[w]||{};return n[i]||(n[i]=e())}const Se="Sentry Logger ",V={};function be(i){if(!("console"in g))return i();const e=g.console,t={},s=Object.keys(V);s.forEach(n=>{const r=V[n];t[n]=e[n],e[n]=r});try{return i()}finally{s.forEach(n=>{e[n]=t[n]})}}function ve(){R().enabled=!0}function we(){R().enabled=!1}function W(){return R().enabled}function _e(...i){O("log",...i)}function De(...i){O("warn",...i)}function Ce(...i){O("error",...i)}function O(i,...e){y&&W()&&be(()=>{g.console[i](`${Se}[${i}]:`,...e)})}function R(){return y?G("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const k={enable:ve,disable:we,isEnabled:W,log:_e,warn:De,error:Ce},ke=Object.prototype.toString;function Ae(i,e){return ke.call(i)===`[object ${e}]`}function Ee(i){return Ae(i,"Object")}function Te(i){return!!(i?.then&&typeof i.then=="function")}function Ke(i,e,t){try{Object.defineProperty(i,e,{value:t,writable:!0,configurable:!0})}catch{y&&k.log(`Failed to add non-enumerable property "${e}" to object`,i)}}function Ie(i,e=0){return typeof i!="string"||e===0||i.length<=e?i:`${i.slice(0,e)}...`}function xe(){const i=g;return i.crypto||i.msCrypto}let L;function Pe(){return Math.random()*16}function _(i=xe()){try{if(i?.randomUUID)return i.randomUUID().replace(/-/g,"")}catch{}return L||(L="10000000100040008000"+1e11),L.replace(/[018]/g,e=>(e^(Pe()&15)>>e/4).toString(16))}const Y=1e3;function Q(){return Date.now()/Y}function Ue(){const{performance:i}=g;if(!i?.now||!i.timeOrigin)return Q;const e=i.timeOrigin;return()=>(e+i.now())/Y}let X;function Ge(){return(X??(X=Ue()))()}function Oe(i,e={}){if(e.user&&(!i.ipAddress&&e.user.ip_address&&(i.ipAddress=e.user.ip_address),!i.did&&!e.did&&(i.did=e.user.id||e.user.email||e.user.username)),i.timestamp=e.timestamp||Ge(),e.abnormal_mechanism&&(i.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(i.ignoreDuration=e.ignoreDuration),e.sid&&(i.sid=e.sid.length===32?e.sid:_()),e.init!==void 0&&(i.init=e.init),!i.did&&e.did&&(i.did=`${e.did}`),typeof e.started=="number"&&(i.started=e.started),i.ignoreDuration)i.duration=void 0;else if(typeof e.duration=="number")i.duration=e.duration;else{const t=i.timestamp-i.started;i.duration=t>=0?t:0}e.release&&(i.release=e.release),e.environment&&(i.environment=e.environment),!i.ipAddress&&e.ipAddress&&(i.ipAddress=e.ipAddress),!i.userAgent&&e.userAgent&&(i.userAgent=e.userAgent),typeof e.errors=="number"&&(i.errors=e.errors),e.status&&(i.status=e.status)}function Z(i,e,t=2){if(!e||typeof e!="object"||t<=0)return e;if(i&&Object.keys(e).length===0)return i;const s={...i};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=Z(s[n],e[n],t-1));return s}function ee(){return _()}const $="_sentrySpan";function te(i,e){e?Ke(i,$,e):delete i[$]}function se(i){return i[$]}const Re=100;class p{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._attributes={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:ee(),sampleRand:Math.random()}}clone(){const e=new p;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._attributes={...this._attributes},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,te(e,se(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Oe(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this.setTags({[e]:t})}setAttributes(e){return this._attributes={...this._attributes,...e},this._notifyScopeListeners(),this}setAttribute(e,t){return this.setAttributes({[e]:t})}removeAttribute(e){return e in this._attributes&&(delete this._attributes[e],this._notifyScopeListeners()),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return t===null?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t=typeof e=="function"?e(this):e,s=t instanceof p?t.getScopeData():Ee(t)?e:void 0,{tags:n,attributes:r,extra:o,user:a,contexts:u,level:d,fingerprint:l=[],propagationContext:fe}=s||{};return this._tags={...this._tags,...n},this._attributes={...this._attributes,...r},this._extra={...this._extra,...o},this._contexts={...this._contexts,...u},a&&Object.keys(a).length&&(this._user=a),d&&(this._level=d),l.length&&(this._fingerprint=l),fe&&(this._propagationContext=fe),this}clear(){return this._breadcrumbs=[],this._tags={},this._attributes={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,te(this,void 0),this._attachments=[],this.setPropagationContext({traceId:ee(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const s=typeof t=="number"?t:Re;if(s<=0)return this;const n={timestamp:Q(),...e,message:e.message?Ie(e.message,2048):e.message};return this._breadcrumbs.push(n),this._breadcrumbs.length>s&&(this._breadcrumbs=this._breadcrumbs.slice(-s),this._client?.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,attributes:this._attributes,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:se(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=Z(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const s=t?.event_id||_();if(!this._client)return y&&k.warn("No client configured on scope - will not capture exception!"),s;const n=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:n,...t,event_id:s},this),s}captureMessage(e,t,s){const n=s?.event_id||_();if(!this._client)return y&&k.warn("No client configured on scope - will not capture message!"),n;const r=s?.syntheticException??new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:r,...s,event_id:n},this),n}captureEvent(e,t){const s=t?.event_id||_();return this._client?(this._client.captureEvent(e,{...t,event_id:s},this),s):(y&&k.warn("No client configured on scope - will not capture event!"),s)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}function Le(){return G("defaultCurrentScope",()=>new p)}function $e(){return G("defaultIsolationScope",()=>new p)}class Be{constructor(e,t){let s;e?s=e:s=new p;let n;t?n=t:n=new p,this._stack=[{scope:s}],this._isolationScope=n}withScope(e){const t=this._pushScope();let s;try{s=e(t)}catch(n){throw this._popScope(),n}return Te(s)?s.then(n=>(this._popScope(),n),n=>{throw this._popScope(),n}):(this._popScope(),s)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function S(){const i=H(),e=U(i);return e.stack=e.stack||new Be(Le(),$e())}function Ne(i){return S().withScope(i)}function Me(i,e){const t=S();return t.withScope(()=>(t.getStackTop().scope=i,e(i)))}function ie(i){return S().withScope(()=>i(S().getIsolationScope()))}function qe(){return{withIsolationScope:ie,withScope:Ne,withSetScope:Me,withSetIsolationScope:(i,e)=>ie(e),getCurrentScope:()=>S().getScope(),getIsolationScope:()=>S().getIsolationScope()}}function Fe(i){const e=U(i);return e.acs?e.acs:qe()}function Je(){const i=H();return Fe(i).getCurrentScope()}function st(i){}function ze(i,e){return Je().captureException(i,void 0)}class ne{constructor(e){this.apiClient=e}async init(e){return this.apiClient.post("/v1/configs/get-init",e)}async fetch(e){return this.apiClient.post("/v1/configs/get-fetch",e)}}class re{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/ab-tests")}async getActive(){return this.apiClient.get("/v1/ab-tests/active")}async getById(e){return this.apiClient.get(`/v1/ab-tests/${e}`)}async getVariant(e){return this.apiClient.get(`/v1/ab-tests/${e}/variant`)}async create(e){return this.apiClient.post("/v1/ab-tests",e)}async update(e,t){return this.apiClient.request(`/v1/ab-tests/${e}`,{method:"PUT",body:JSON.stringify(t)})}async patch(e,t){return this.apiClient.request(`/v1/ab-tests/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.apiClient.request(`/v1/ab-tests/${e}`,{method:"DELETE"})}}class oe{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/remote-configs")}async getById(e){return this.apiClient.get(`/v1/remote-configs/${e}`)}async create(e){return this.apiClient.post("/v1/remote-configs",e)}async update(e,t){return this.apiClient.request(`/v1/remote-configs/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.apiClient.request(`/v1/remote-configs/${e}`,{method:"DELETE"})}async refresh(){return this.apiClient.post("/v1/remote-configs/refresh",{})}}class ae{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/segments")}async getById(e){return this.apiClient.get(`/v1/segments/${e}`)}async getUserSegments(){return this.apiClient.get("/v1/segments/user")}async create(e){return this.apiClient.post("/v1/segments",e)}async update(e,t){return this.apiClient.request(`/v1/segments/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.apiClient.request(`/v1/segments/${e}`,{method:"DELETE"})}}class ce{constructor(e){this.getAuthToken=e}buildUrl(e){const t=h.authUrl.replace(/\/+$/,""),s=e.replace(/^\/+/,"");return`${t}/${s}`}async request(e,t={}){const s=this.buildUrl(e),n=this.getAuthToken(),r={"Content-Type":"application/json",...t.headers};n&&(r.Authorization=`Bearer ${n}`);const o=await fetch(s,{...t,headers:r,credentials:"include"});if(!o.ok){const u=await o.text();let d=`Request failed with status ${o.status}`;try{const l=JSON.parse(u);Array.isArray(l.message)?d=l.message.join(", "):l.message?d=l.message:l.error&&(d=l.error)}catch{}throw new Error(d)}const a=await o.text();return a?JSON.parse(a):null}async getAll(){return this.request("/v1/users")}async getById(e){return this.request(`/v1/users/${e}`)}async search(e){return this.request(`/v1/users/search?q=${encodeURIComponent(e)}`)}async create(e){return this.request("/v1/users",{method:"POST",body:JSON.stringify(e)})}async update(e,t){return this.request(`/v1/users/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.request(`/v1/users/${e}`,{method:"DELETE"})}}class le{constructor(e){this.apiClient=e}async getVersion(){return this.apiClient.get("/v1")}async check(){return this.apiClient.get("/v1/health")}async detailed(){return this.apiClient.get("/v1/health/detailed")}}class de{constructor(e){this.getAuthToken=e}buildUrl(e){const t=h.authUrl.replace(/\/+$/,""),s=e.replace(/^\/+/,"");return`${t}/${s}`}async request(e,t={}){const s=this.buildUrl(e);let n=this.getAuthToken();!n&&typeof localStorage<"u"&&(n=localStorage.getItem("coreSDK_token")||void 0);const r={"Content-Type":"application/json",...t.headers};n&&(r.Authorization=`Bearer ${n}`);const o=await fetch(s,{...t,headers:r,credentials:"include"});if(!o.ok){const u=await o.text();let d=`Request failed with status ${o.status}`;try{const l=JSON.parse(u);Array.isArray(l.message)?d=l.message.join(", "):l.message&&(d=l.message)}catch{}throw new Error(d)}const a=await o.text();return a?JSON.parse(a):null}async init(e){return this.request("/v1/auth/init",{method:"POST",body:JSON.stringify(e)})}async signin(e){return this.request("/v1/auth/signin",{method:"POST",body:JSON.stringify(e)})}async confirmCode(e){return this.request("/v1/auth/code",{method:"POST",body:JSON.stringify(e)})}async logout(){try{await this.request("/v1/auth/logout",{method:"POST"})}catch{}}async getOAuthConfig(){return this.request("/v1/auth/oauth/config",{method:"GET"})}async googleSignIn(e,t){return this.init({...t,et:e,pr:"google"})}async health(){return this.request("/v1/health",{method:"GET"})}}class ue{constructor(e){this.getAuthToken=e}buildUrl(e){const t=h.configUrl.replace(/\/+$/,""),s=e.replace(/^\/+/,"");return`${t}/${s}`}async request(e,t={}){const s=this.buildUrl(e),n=this.getAuthToken(),r={"Content-Type":"application/json",...t.headers};n&&(r.Authorization=`Bearer ${n}`);const o=await fetch(s,{...t,headers:r,credentials:"include"});if(!o.ok){const u=await o.text();let d=`Request failed with status ${o.status}`;try{const l=JSON.parse(u);Array.isArray(l.message)?d=l.message.join(", "):l.message&&(d=l.message)}catch{}throw new Error(d)}const a=await o.text();return a?JSON.parse(a):null}async list(e){const t=e?`?pattern=${encodeURIComponent(e)}`:"";return this.request(`/v1/player-kv/list${t}`,{method:"GET"})}async get(e){return this.request(`/v1/player-kv/get/${encodeURIComponent(e)}`,{method:"GET"})}async set(e,t,s){return this.request("/v1/player-kv/set",{method:"POST",body:JSON.stringify({key:e,value:t,ttl:s})})}async delete(e){return this.request(`/v1/player-kv/${encodeURIComponent(e)}`,{method:"DELETE"})}async exists(e){return this.request(`/v1/player-kv/exists/${encodeURIComponent(e)}`,{method:"GET"})}async getMany(e){const t={},s=e.map(async n=>{try{const r=await this.get(n);t[n]=r.value}catch{t[n]=null}});return await Promise.all(s),t}async setMany(e,t){const s=Object.entries(e).map(([n,r])=>this.set(n,r,t));await Promise.all(s)}async deleteMany(e){const t=e.map(s=>this.delete(s));await Promise.all(t)}}class je{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/events")}async send(e){return this.apiClient.post("/v1/events",e)}}const A="1.0.80",E=[A,"1.0.3","1.0.0"];function he(i){return E.includes(i)}function ge(i){if(!he(i)){const e=E.join(", ");throw new Error(`[SDK] Unsupported version "${i}". Supported versions: ${e}. Current SDK version: ${A}`)}}class He{constructor(e){this.getAuthToken=e}buildUrl(e){const t=(h.profileUrl||h.configUrl).replace(/\/+$/,""),s=e.replace(/^\/+/,"");return`${t}/${s}`}async request(e,t={}){const s=this.buildUrl(e),n=this.getAuthToken(),r={"Content-Type":"application/json",...t.headers};n&&(r.Authorization=`Bearer ${n}`);const o=await fetch(s,{...t,headers:r});if(!o.ok){const u=await o.text();let d=`Request failed with status ${o.status}`;try{const l=JSON.parse(u);l.message&&(d=l.message)}catch{}throw new Error(d)}const a=await o.text();return a?JSON.parse(a):null}async get(){return this.request("/v1/state",{method:"GET"})}async update(e){return this.request("/v1/state",{method:"PUT",body:JSON.stringify({meta:e})})}async getProfile(){return this.request("/v1/profile",{method:"GET"})}async updateProfile(e){return this.request("/v1/profile",{method:"PATCH",body:JSON.stringify(e)})}async getField(e){return this.request(`/v1/profile/field/${e}`,{method:"GET"})}async setField(e,t){return this.request(`/v1/profile/field/${e}`,{method:"PUT",body:JSON.stringify({value:t})})}async kvList(){return this.request("/v1/kv/list",{method:"GET"})}async kvGet(e){return this.request(`/v1/kv/${e}`,{method:"GET"})}async kvSet(e,t,s){await this.request("/v1/kv/set",{method:"POST",body:JSON.stringify({key:e,value:t,ttl:s})})}async kvDelete(e){return this.request(`/v1/kv/${e}`,{method:"DELETE"})}async kvExists(e){return this.request(`/v1/kv/exists/${e}`,{method:"GET"})}}class B{constructor(e,t){this.response=e,this.configs=t}get(e){const t=this.parsePath(e);if(t.length===0)return;const[s,...n]=t;let r=this.configs[s];for(const o of n){if(r==null)return;r=r[o]}return r}has(e){return this.get(e)!==void 0}keys(){const e=[];for(const t of Object.keys(this.configs))for(const s of Object.keys(this.configs[t]))e.push(`${t}.${s}`);return e}values(){const e=[];for(const t of Object.values(this.configs))for(const s of Object.values(t))e.push(s);return e}getAll(){return this.configs}getScope(e){return this.configs[e]}getMeta(){return{segment:this.response.segment,ab:this.response.ab,abG:this.response.abG,abExp:this.response.abExp}}raw(){return this.response}parsePath(e){return e.split(/\.|\[|\]/).filter(Boolean).map(t=>{const s=parseInt(t,10);return isNaN(s)?t:s})}}const Ve=(i,e)=>{},f={AUTH_SUCCESS:"core:authSuccess",AUTH_ERROR:"core:authError"},T={ios:1,android:2,web:3,windows:3,macos:3,linux:3,unknown:3};class m{constructor(){this.eventBus=new J,this.systemParams={},this.initialized=!1,this.oauthConfig=null,this.configState={configs:{}},this.ads={registerMediator:Ve},this.detectEnvironment();try{const e=localStorage.getItem("coreSDK_token");e&&(this.systemParams.authToken=e,console.log("[SDK] constructor: restored token from localStorage"));const t=localStorage.getItem("coreSDK_configUrl"),s=localStorage.getItem("coreSDK_authUrl"),n=localStorage.getItem("coreSDK_profileUrl");t&&(K(t),console.log("[SDK] constructor: restored configUrl from localStorage")),s&&(I(s),console.log("[SDK] constructor: restored authUrl from localStorage")),n&&(M(n),console.log("[SDK] constructor: restored profileUrl from localStorage"))}catch(e){console.error("[SDK] constructor: failed to restore state:",e)}this.apiClient=new F(()=>this.systemParams.authToken),this.configs=new ne(this.apiClient),this.abTests=new re(this.apiClient),this.remoteConfigs=new oe(this.apiClient),this.segments=new ae(this.apiClient),this.users=new ce(()=>this.systemParams.authToken),this.health=new le(this.apiClient),this.auth=new de(()=>this.systemParams.authToken),this.playerKv=new ue(()=>this.systemParams.authToken),this.events=new je(this.apiClient),this.profileClient=new C(()=>this.systemParams.authToken,this.eventBus),this.profileApi=new He(()=>this.systemParams.authToken),this.gamestate=this.profileApi}static getInstance(){return m.instance||(m.instance=new m),m.instance}async init(e,t){if(console.log(`[SDK] v${A} init: start`,e),e?.version){console.log(`[SDK] init: validating app version "${e.version}"...`);try{ge(e.version),console.log(`[SDK] init: app version "${e.version}" is supported`)}catch(n){throw console.error(`[SDK] init: VERSION ERROR - ${n.message}`),console.error(`[SDK] init: Supported versions: ${E.join(", ")}`),n}}if(this.initialized){console.log("[SDK] init: already initialized, skipping"),t&&this.isAuthenticated()&&(console.log("[SDK] init: already authenticated, calling onAuthReady"),t());return}e?.configUrl&&(console.log("[SDK] init: set base url ->",e.configUrl),K(e.configUrl),this.storeUrl("coreSDK_configUrl",e.configUrl)),e?.authUrl&&(console.log("[SDK] init: set auth url ->",e.authUrl),I(e.authUrl),this.storeUrl("coreSDK_authUrl",e.authUrl)),e?.profileUrl&&(console.log("[SDK] init: set profile url ->",e.profileUrl),M(e.profileUrl),this.storeUrl("coreSDK_profileUrl",e.profileUrl));const s=this.getStoredToken();if(s){console.log("[SDK] init: restoring token from localStorage"),this.systemParams.authToken=s,this.profileClient=new C(()=>this.systemParams.authToken,this.eventBus),this.initialized=!0,console.log("[SDK] init: restored session, SDK ready"),t&&(console.log("[SDK] init: calling onAuthReady after token restore"),t());return}if(this.systemParams.authToken){console.log("[SDK] init: token already set, SDK ready"),this.profileClient=new C(()=>this.systemParams.authToken,this.eventBus),this.initialized=!0,t&&(console.log("[SDK] init: calling onAuthReady (token already set)"),t());return}try{console.log("[SDK] init: set system params ->",e),e&&this.setSystemParams(e),console.log("[SDK] init: ensure device id…");const n=await this.ensureDeviceId();console.log("[SDK] init: deviceId =",n),this.systemParams.deviceId=n,e?.skipAuth?console.log("[SDK] init: skipAuth=true, skipping auth"):this.isAuthenticated()?console.log("[SDK] init: already authenticated, skipping auth modal"):(console.log("[SDK] init: showing auth modal…"),await this.showAuthModal(),console.log("[SDK] init: auth completed")),this.profileClient=new C(()=>this.systemParams.authToken,this.eventBus),console.log("[SDK] init: profile module initialized"),this.on(P.PROFILE_UPDATED,r=>{try{const o=r?.gid??r?.detail?.gid;o&&(console.log("[SDK] profile cache invalidated for",o),this.profileClient.invalidate(o))}catch(o){console.error("[SDK] profile cache invalidation error:",o)}}),this.initialized=!0,console.log("[SDK] init: COMPLETE"),await this.initAds(),this.eventBus.emit("core:initialized",this.getSystemParams()),t&&this.isAuthenticated()&&(console.log("[SDK] init: calling onAuthReady after init"),t())}catch(n){throw console.error("[SDK] init: ERROR",n),this.captureError(n),n}}captureError(e){try{ze(e)}catch(t){console.error("[SDK] Sentry capture error:",t)}}showAuthModal(){return new Promise((e,t)=>{new j({googleEnabled:!0,onGoogleClick:async()=>{try{if(await this.loadOAuthConfig(),!this.getGoogleClientId()){console.warn("[SDK] Google Client ID not configured, falling back to guest"),await this.loginAsGuest(),e();return}const{credential:r}=await this.getGoogleIdToken();await this.loginWithGoogle(r),e()}catch(n){console.error("[SDK] Google auth failed:",n),t(n)}},onGuestClick:async()=>{try{await this.loginAsGuest(),e()}catch(n){t(n)}},onClose:()=>{t(new Error("Auth cancelled by user"))}}).show()})}async loginAsGuest(){try{const t=!this.getStoredDeviceId();console.log(t?"[SDK] loginAsGuest: no deviceId found, registering new guest...":"[SDK] loginAsGuest: deviceId found, logging in existing guest...");const s=await this.ensureDeviceId(),n=T[this.systemParams.os||"web"]||3,r=this.systemParams.app||"default",o=this.getStoredToken();console.log("[SDK] loginAsGuest: calling /auth/init",{did:s,os:n,app:r,hasToken:!!o});const a=await this.auth.init({app:r,os:n,did:s,ln:this.getLanguage(),tk:o||void 0}),u=a?.jwt??null;if(!u)throw console.error("[SDK] loginAsGuest: ERROR missing jwt",a),new Error("Guest login failed: missing jwt token");return this.storeToken(u),this.storeAuthType("guest",a.an),this.systemParams.authToken=u,this.eventBus.emit(f.AUTH_SUCCESS,{type:"guest",isNewGuest:t,uid:a.uid,gid:a.gid,anonymous:a.an}),console.log(`[SDK] loginAsGuest: SUCCESS (${t?"registered":"logged in"})`,{uid:a.uid,gid:a.gid,anonymous:a.an}),a}catch(e){throw console.error("[SDK] loginAsGuest: ERROR",e),this.eventBus.emit(f.AUTH_ERROR,{error:e}),this.captureError(e),e}}async signinWithEmail(e){try{console.log("[SDK] signinWithEmail: start",{email:e});const t=T[this.systemParams.os||"web"]||3,s=this.systemParams.app||"default",n=await this.auth.signin({app:s,os:t,email:e,ln:this.getLanguage()});if("rid"in n)return console.log("[SDK] signinWithEmail: code sent, rid =",n.rid),{rid:n.rid};throw new Error("Unexpected response from signin")}catch(t){throw console.error("[SDK] signinWithEmail: ERROR",t),this.captureError(t),t}}async confirmCode(e,t){try{console.log("[SDK] confirmCode: start",{rid:e,code:t});const s=await this.auth.confirmCode({rid:e,code:t}),n=s?.jwt??null;if(!n)throw new Error("Code confirmation failed: missing jwt token");return this.storeToken(n),this.storeAuthType("email",s.an),this.systemParams.authToken=n,this.eventBus.emit(f.AUTH_SUCCESS,{type:"email",uid:s.uid,gid:s.gid,anonymous:s.an}),console.log("[SDK] confirmCode: SUCCESS",{uid:s.uid,gid:s.gid}),s}catch(s){throw console.error("[SDK] confirmCode: ERROR",s),this.captureError(s),s}}async signinWithProvider(e,t){try{console.log("[SDK] signinWithProvider: start",{provider:e});const s=T[this.systemParams.os||"web"]||3,n=this.systemParams.app||"default",r=await this.auth.signin({app:n,os:s,ln:this.getLanguage(),et:t,pr:e});if("rid"in r)throw new Error("Unexpected response: got rid instead of auth response");const o=r?.jwt??null;if(!o)throw new Error("Provider signin failed: missing jwt token");return this.storeToken(o),this.storeAuthType(e,r.an),this.systemParams.authToken=o,this.eventBus.emit(f.AUTH_SUCCESS,{type:e,uid:r.uid,gid:r.gid,anonymous:r.an}),console.log("[SDK] signinWithProvider: SUCCESS",{uid:r.uid,gid:r.gid}),r}catch(s){throw console.error("[SDK] signinWithProvider: ERROR",s),this.captureError(s),s}}async logout(){try{console.log("[SDK] logout: start"),this.clearToken(),this.clearAuthType(),this.systemParams.authToken=void 0,console.log("[SDK] logout: COMPLETE")}catch(e){throw console.error("[SDK] logout: ERROR",e),this.captureError(e),e}}setSystemParams(e){this.systemParams={...this.systemParams,...e}}getSystemParams(){const{isCordova:e,os:t,...s}=this.systemParams;return s}on(e,t){this.eventBus.on(e,t)}once(e,t){this.eventBus.once(e,t)}off(e,t){this.eventBus.off(e,t)}emit(e,...t){this.eventBus.emit(e,...t)}detectEnvironment(){const e=typeof navigator<"u"?navigator.userAgent:"",t=typeof window<"u"&&typeof window.cordova<"u";this.systemParams.os=this.detectOS(e),this.systemParams.isCordova=t}detectOS(e){return/android/i.test(e)?"android":/iPad|iPhone|iPod/i.test(e)?"ios":/Win/i.test(e)?"windows":/Mac/i.test(e)?"macos":/Linux/i.test(e)?"linux":"web"}getLanguage(){return typeof navigator<"u"&&navigator.language?navigator.language.split("-")[0]:"en"}async ensureDeviceId(){const e=this.getStoredDeviceId();if(e)return e;const t=await this.tryGetCordovaDeviceId();if(t)return this.storeDeviceId(t),t;const s=this.generateGuid();return this.storeDeviceId(s),s}getStoredDeviceId(){try{return localStorage.getItem("coreSDK_deviceId")}catch(e){return console.error("[SDK] getStoredDeviceId error:",e),null}}storeDeviceId(e){try{localStorage.setItem("coreSDK_deviceId",e)}catch(t){console.error("[SDK] storeDeviceId error:",t)}}getStoredToken(){try{return localStorage.getItem("coreSDK_token")}catch(e){return console.error("[SDK] getStoredToken error:",e),null}}storeToken(e){try{localStorage.setItem("coreSDK_token",e)}catch(t){console.error("[SDK] storeToken error:",t)}}clearToken(){try{localStorage.removeItem("coreSDK_token")}catch(e){console.error("[SDK] clearToken error:",e)}}storeAuthType(e,t){try{localStorage.setItem("coreSDK_authType",e),localStorage.setItem("coreSDK_isAnonymous",t?"true":"false")}catch(s){console.error("[SDK] storeAuthType error:",s)}}getStoredAuthType(){try{const e=localStorage.getItem("coreSDK_authType"),t=localStorage.getItem("coreSDK_isAnonymous")==="true";return{authType:e,isAnonymous:t}}catch(e){return console.error("[SDK] getStoredAuthType error:",e),{authType:null,isAnonymous:!1}}}clearAuthType(){try{localStorage.removeItem("coreSDK_authType"),localStorage.removeItem("coreSDK_isAnonymous")}catch(e){console.error("[SDK] clearAuthType error:",e)}}storeUrl(e,t){try{localStorage.setItem(e,t)}catch(s){console.error(`[SDK] storeUrl(${e}) error:`,s)}}async tryGetCordovaDeviceId(){if(typeof window>"u")return null;const t=window.device;return t?.uuid?String(t.uuid):null}generateGuid(){const e=()=>Math.floor((1+Math.random())*65536).toString(16).substring(1);return`${e()}${e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`}get profile(){return this.profileClient}isAuthenticated(){return!!this.systemParams.authToken}isGuest(){const{authType:e,isAnonymous:t}=this.getStoredAuthType();return e==="guest"||t}getAuthStatus(){const e=this.isAuthenticated(),{authType:t,isAnonymous:s}=this.getStoredAuthType();return{isAuthenticated:e,authType:e?t:null,isAnonymous:e&&s}}async loadOAuthConfig(){if(this.oauthConfig)return this.oauthConfig;try{return console.log("[SDK] loadOAuthConfig: fetching..."),this.oauthConfig=await this.auth.getOAuthConfig(),console.log("[SDK] loadOAuthConfig: success",this.oauthConfig),this.oauthConfig}catch(e){return console.error("[SDK] loadOAuthConfig: ERROR",e),null}}getGoogleClientId(){return this.oauthConfig?.google?.clientId??null}async loginWithGoogle(e){try{console.log("[SDK] loginWithGoogle: start");const t=await this.ensureDeviceId(),s=T[this.systemParams.os||"web"]||3,n=this.systemParams.app||"default",r=await this.auth.googleSignIn(e,{app:n,os:s,did:t,ln:this.getLanguage()}),o=r?.jwt??null;if(!o)throw new Error("Google login failed: missing jwt token");return this.storeToken(o),this.storeAuthType("google",r.an),this.systemParams.authToken=o,this.eventBus.emit(f.AUTH_SUCCESS,{type:"google",uid:r.uid,gid:r.gid,anonymous:r.an}),console.log("[SDK] loginWithGoogle: SUCCESS",{uid:r.uid,gid:r.gid}),r}catch(t){throw console.error("[SDK] loginWithGoogle: ERROR",t),this.eventBus.emit(f.AUTH_ERROR,{error:t}),this.captureError(t),t}}async getGoogleIdToken(e){try{console.log("[SDK] getGoogleIdToken: start"),await this.loadOAuthConfig();const t=this.getGoogleClientId();if(!t)throw new Error("Google Client ID not configured. Check OAuth config.");await v.loadScript();const s=await v.requestToken(t,e);return console.log("[SDK] getGoogleIdToken: SUCCESS"),s}catch(t){throw console.error("[SDK] getGoogleIdToken: ERROR",t),this.captureError(t),t}}async initConfigs(e){try{console.log("[SDK] initConfigs:",e);const t=await this.configs.init({v:e.version,scopes:e.scopes,keys:e.keys,values:e.values,segment:e.segment,ab:this.configState.ab,abG:this.configState.abG,abExp:this.configState.abExp});return this.configState={segment:t.segment,ab:t.ab,abG:t.abG,abExp:t.abExp,configs:t.configs||{}},console.log("[SDK] initConfigs: SUCCESS",{segment:t.segment,ab:t.ab,abG:t.abG}),new B(t,this.configState.configs)}catch(t){throw console.error("[SDK] initConfigs: ERROR",t),this.captureError(t),t}}async fetchConfigs(e){try{console.log("[SDK] fetchConfigs:",e);const t=await this.configs.fetch({v:e.version,segment:this.configState.segment,scopes:e.scopes,keys:e.keys,values:e.values});return t.configs&&(this.configState.configs={...this.configState.configs,...t.configs}),console.log("[SDK] fetchConfigs: SUCCESS",{scopes:Object.keys(t.configs||{})}),new B(t,this.configState.configs)}catch(t){throw console.error("[SDK] fetchConfigs: ERROR",t),this.captureError(t),t}}getConfig(e,t){return this.configState.configs[e]?.[t]}getConfigsByScope(e){return this.configState.configs[e]}getSegment(){return this.configState.segment}getABTest(){return{ab:this.configState.ab,abG:this.configState.abG,abExp:this.configState.abExp}}showAd(e,t,s){return this.adManager.showAd(e,t,s)}async initAds(){await this.adManager.init()}__setConfigForTests(e,t){this.configStore.set(e,t)}}const pe=m.getInstance(),b=[{name:"core",description:"Core SDK initialization",methods:[{name:"init",description:"Initialize SDK with config",enabled:!0,example:`await coreSDK.init({
                  app: "test-frontend",
                  configUrl: "http://localhost:3000",
                  authUrl: "http://localhost:3001",
                  profileUrl: "http://localhost:3002",
                  version: "1.0.0",
                    skipAuth: false
                }, () => {
                  console.log("SDK initialized and authenticated!");
                });`},{name:"getSystemParams",description:"Get current system parameters",enabled:!0,example:`const params = coreSDK.getSystemParams();
// { app, version, deviceId, authToken, ... }`},{name:"isAuthenticated",description:"Check if user is authenticated",enabled:!0,example:"const isAuth = coreSDK.isAuthenticated();"},{name:"setSystemParams",description:"Set system parameters (app, version, etc.)",enabled:!0,example:'coreSDK.setSystemParams({ app: "my-game", version: "2.0.0" });'},{name:"isGuest",description:"Check if current user is a guest",enabled:!0,example:"const isGuest = coreSDK.isGuest();"},{name:"on",description:"Subscribe to SDK events",enabled:!0,example:`coreSDK.on("auth:login", (user) => console.log("Logged in:", user));
coreSDK.on("auth:logout", () => console.log("Logged out"));
coreSDK.on("profile:updated", (profile) => console.log("Profile updated"));`},{name:"once",description:"Subscribe to SDK event (fires once)",enabled:!0,example:'coreSDK.once("core:initialized", () => console.log("SDK ready"));'},{name:"off",description:"Unsubscribe from SDK events",enabled:!0,example:`const handler = (user) => console.log(user);
coreSDK.on("auth:login", handler);
coreSDK.off("auth:login", handler);`}]},{name:"auth",description:"Authentication methods",methods:[{name:"loginAsGuest",description:"Login as guest user",enabled:!0,example:"await coreSDK.loginAsGuest();"},{name:"loginWithGoogle",description:"Login with Google OAuth",enabled:!0,example:`const { credential } = await coreSDK.getGoogleIdToken();
await coreSDK.loginWithGoogle(credential);`},{name:"getGoogleIdToken",description:"Get Google ID Token for custom Sign-In UI",enabled:!0,example:"const { credential, select_by } = await coreSDK.getGoogleIdToken();"},{name:"logout",description:"Logout current user",enabled:!0,example:"await coreSDK.logout();"},{name:"getAuthStatus",description:"Get authentication status and type",enabled:!0,example:`const status = coreSDK.getAuthStatus();
// { isAuthenticated: true, authType: "google", isAnonymous: false }`},{name:"signinWithEmail",description:"Sign in with email (sends verification code)",enabled:!0,example:`await coreSDK.signinWithEmail("user@example.com");
// Sends verification code to email`},{name:"confirmCode",description:"Confirm verification code from email",enabled:!0,example:`const result = await coreSDK.confirmCode("123456");
// { accessToken, refreshToken, user }`},{name:"signinWithProvider",description:"Sign in with external provider",enabled:!0,example:'await coreSDK.signinWithProvider("google", { idToken: "..." });'}]},{name:"configs",description:"Configs API (segments, A/B tests, filters)",methods:[{name:"sdk.initConfigs",description:"Initialize configs with segment and A/B test assignment",enabled:!0,example:`const response = await coreSDK.initConfigs({
  version: "1.0.0",
  scopes: ["gameplay", "ui"],
  values: { isPremium: false, country: "US", level: 10 }
});
// Returns: { segment, ab, abG, abExp, configs }`},{name:"sdk.fetchConfigs",description:"Fetch configs by scopes with MongoDB-style filters",enabled:!0,example:`const response = await coreSDK.fetchConfigs({
  version: "1.0.0",
  scopes: ["monetization", "gameplay"],
  values: { isPremium: true, level: 50 }
});
// Filters: $eq, $ne, $gt, $gte, $lt, $lte, $in, $nin`},{name:"sdk.getConfig",description:"Get specific config value by scope and key",enabled:!0,example:'const maxLives = coreSDK.getConfig("gameplay", "maxLives");'},{name:"sdk.getConfigsByScope",description:"Get all configs in a scope",enabled:!0,example:'const uiConfigs = coreSDK.getConfigsByScope("ui");'},{name:"sdk.getConfigState",description:"Get current segment and A/B test state",enabled:!0,example:`// Get user segment
const segment = coreSDK.getSegment(); // "premium" | undefined

// Get A/B test assignment
const { ab, abG, abExp } = coreSDK.getABTest();
// ab = test key, abG = group key, abExp = expiration timestamp`},{name:"configResult.get",description:"Get config value by path (supports nested access)",enabled:!0,example:`const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay'] });

// Simple path
configs.get('gameplay.maxLives');           // 3

// Array access
configs.get('gameplay.items[0].name');      // "sword"

// Nested object
configs.get('gameplay.rewards.daily');      // { coins: 100 }

// Typed result
configs.get<number>('gameplay.maxLives');   // 3 (typed)`},{name:"configResult.has",description:"Check if config path exists",enabled:!0,example:`const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay'] });

configs.has('gameplay.maxLives');    // true
configs.has('gameplay.notExists');   // false`},{name:"configResult.keys",description:"Get all config keys in flat format",enabled:!0,example:`const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay', 'ui'] });

configs.keys();
// ['gameplay.maxLives', 'gameplay.items', 'ui.theme', 'ui.colors']`},{name:"configResult.values",description:"Get all config values",enabled:!0,example:`const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay', 'ui'] });

configs.values();
// [3, [...], 'dark', { primary: '#000' }]`},{name:"configResult.getScope",description:"Get all configs for a specific scope",enabled:!0,example:`const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay', 'ui'] });

configs.getScope('gameplay');
// { maxLives: 3, items: [...], rewards: { daily: { coins: 100 } } }`},{name:"configResult.getAll",description:"Get all configs grouped by scope",enabled:!0,example:`const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay', 'ui'] });

configs.getAll();
// { gameplay: { maxLives: 3, ... }, ui: { theme: 'dark', ... } }`},{name:"configResult.getMeta",description:"Get segment and A/B test metadata",enabled:!0,example:`const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay'] });

configs.getMeta();
// { segment: 'premium', ab: 'test_a', abG: 'control', abExp: 1234567890 }`},{name:"configResult.raw",description:"Get raw ConfigResponse from server",enabled:!0,example:`const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay'] });

configs.raw();
// Original ConfigResponse: { segment, ab, abG, abExp, configs: {...} }`}]},{name:"profile",description:"User profile methods",methods:[{name:"profile.getProfile",description:"Get full user profile",enabled:!0,example:`const profile = await coreSDK.profile.getProfile();
// { id, version, base: { name, avatar }, scopes: { game: {...} } }`},{name:"profile.updateProfile",description:"Update profile (partial merge)",enabled:!0,example:`await coreSDK.profile.updateProfile({
  base: { name: "NewName" },
  scopes: { game: { level: 10 } }
});`},{name:"profile.getProfileField",description:"Get field value by dot-notation path",enabled:!0,example:'const level = await coreSDK.profile.getProfileField("scopes.game.level");'},{name:"profile.setProfileField",description:"Set field value by dot-notation path",enabled:!0,example:'await coreSDK.profile.setProfileField("scopes.game.coins", 1000);'},{name:"profile.mergeProfileScope",description:"Merge data into specific scope",enabled:!0,example:'await coreSDK.profile.mergeProfileScope("game", { xp: 500, level: 10 });'},{name:"profile.invalidate",description:"Invalidate profile cache for specific player",enabled:!0,example:'coreSDK.profile.invalidate("player-id");'},{name:"profile.invalidateAll",description:"Invalidate all profile cache",enabled:!0,example:"coreSDK.profile.invalidateAll();"},{name:"profile.resetMyProfileId",description:"Reset current player profile ID (for logout)",enabled:!0,example:"coreSDK.profile.resetMyProfileId();"}]},{name:"kv",description:"Key-Value storage for player data",methods:[{name:"kv.get",description:"Get value by key",enabled:!0,example:'const { value } = await coreSDK.playerKv.get("settings");'},{name:"kv.set",description:"Set value by key",enabled:!0,example:'await coreSDK.playerKv.set("settings", JSON.stringify({ theme: "dark" }));'},{name:"kv.delete",description:"Delete value by key",enabled:!0,example:'await coreSDK.playerKv.delete("settings");'},{name:"kv.exists",description:"Check if key exists",enabled:!0,example:'const { exists } = await coreSDK.playerKv.exists("settings");'},{name:"kv.getMany",description:"Get multiple values by keys",enabled:!0,example:'const values = await coreSDK.playerKv.getMany(["key1", "key2"]);'},{name:"kv.list",description:"List all keys",enabled:!0,example:"const { keys } = await coreSDK.playerKv.list();"},{name:"kv.setMany",description:"Set multiple key-value pairs",enabled:!0,example:`await coreSDK.playerKv.setMany([
  { key: "settings", value: JSON.stringify({ theme: "dark" }) },
  { key: "progress", value: JSON.stringify({ level: 5 }) }
]);`},{name:"kv.deleteMany",description:"Delete multiple keys",enabled:!0,example:'await coreSDK.playerKv.deleteMany(["key1", "key2", "key3"]);'}]},{name:"health",description:"Health check API",methods:[{name:"health.check",description:"Quick health check",enabled:!0,example:`const health = await coreSDK.health.check();
// { status: "ok", timestamp: 1234567890 }`},{name:"health.version",description:"Get service version",enabled:!0,example:"const { version, name } = await coreSDK.health.version();"},{name:"health.getVersion",description:"Get service version (alias)",enabled:!0,example:"const version = await coreSDK.health.getVersion();"},{name:"health.detailed",description:"Get detailed health check with dependencies",enabled:!0,example:`const detailed = await coreSDK.health.detailed();
// { status: "ok", database: "ok", redis: "ok", ... }`}]},{name:"gamestate",description:"Game state persistence",methods:[{name:"gamestate.get",description:"Load current game state",enabled:!0,example:`const { meta } = await coreSDK.gamestate.get();
// meta contains saved game progress`},{name:"gamestate.update",description:"Update game state (deep merge on backend)",enabled:!0,example:`await coreSDK.gamestate.update({
  level: 5,
  coins: 120,
  settings: { sound: false }
});`}]},{name:"abTests",description:"A/B Tests Admin API (disabled)",methods:[{name:"abTests.getAll",description:"Get all A/B tests",enabled:!1,example:"const tests = await coreSDK.abTests.getAll();"},{name:"abTests.getActive",description:"Get all active A/B tests",enabled:!1,example:"const activeTests = await coreSDK.abTests.getActive();"},{name:"abTests.getById",description:"Get A/B test by ID",enabled:!1,example:'const test = await coreSDK.abTests.getById("test-id");'},{name:"abTests.getVariant",description:"Get A/B test variant for current user",enabled:!1,example:'const variant = await coreSDK.abTests.getVariant("test-key");'},{name:"abTests.create",description:"Create A/B test",enabled:!1,example:'await coreSDK.abTests.create({ key: "test", name: "Test", groups: [...] });'},{name:"abTests.update",description:"Update A/B test (full replace)",enabled:!1,example:'await coreSDK.abTests.update("test-id", { name: "Updated Test", ... });'},{name:"abTests.patch",description:"Partially update A/B test",enabled:!1,example:'await coreSDK.abTests.patch("test-id", { name: "New Name" });'},{name:"abTests.delete",description:"Delete A/B test",enabled:!1,example:'await coreSDK.abTests.delete("test-id");'}]},{name:"remoteConfigs",description:"Remote Configs Admin API (disabled)",methods:[{name:"remoteConfigs.getAll",description:"Get all remote configs",enabled:!1,example:"const configs = await coreSDK.remoteConfigs.getAll();"},{name:"remoteConfigs.getById",description:"Get remote config by ID",enabled:!1,example:'const config = await coreSDK.remoteConfigs.getById("config-id");'},{name:"remoteConfigs.create",description:"Create remote config",enabled:!1,example:'await coreSDK.remoteConfigs.create({ key: "ui", scope: "ui", data: {...} });'},{name:"remoteConfigs.update",description:"Update remote config",enabled:!1,example:'await coreSDK.remoteConfigs.update("config-id", { data: {...} });'},{name:"remoteConfigs.delete",description:"Delete remote config",enabled:!1,example:'await coreSDK.remoteConfigs.delete("config-id");'},{name:"remoteConfigs.refresh",description:"Refresh remote configs cache",enabled:!1,example:"await coreSDK.remoteConfigs.refresh();"}]},{name:"segments",description:"Segments Admin API (disabled)",methods:[{name:"segments.getAll",description:"Get all segments",enabled:!1,example:"const segments = await coreSDK.segments.getAll();"},{name:"segments.getById",description:"Get segment by ID",enabled:!1,example:'const segment = await coreSDK.segments.getById("segment-id");'},{name:"segments.getUserSegments",description:"Get segments for current user",enabled:!1,example:"const userSegments = await coreSDK.segments.getUserSegments();"},{name:"segments.create",description:"Create segment",enabled:!1,example:'await coreSDK.segments.create({ key: "vip", name: "VIP", filters: {...} });'},{name:"segments.update",description:"Update segment",enabled:!1,example:'await coreSDK.segments.update("segment-id", { name: "Premium VIP" });'},{name:"segments.delete",description:"Delete segment",enabled:!1,example:'await coreSDK.segments.delete("segment-id");'}]},{name:"users",description:"Users Admin API (disabled)",methods:[{name:"users.getAll",description:"Get all users",enabled:!1,example:"const users = await coreSDK.users.getAll();"},{name:"users.getById",description:"Get user by ID",enabled:!1,example:'const user = await coreSDK.users.getById("user-id");'},{name:"users.search",description:"Search users by query",enabled:!1,example:'const results = await coreSDK.users.search({ email: "user@example.com" });'},{name:"users.create",description:"Create user",enabled:!1,example:'await coreSDK.users.create({ email: "user@example.com", name: "User" });'},{name:"users.update",description:"Update user",enabled:!1,example:'await coreSDK.users.update("user-id", { name: "New Name" });'},{name:"users.delete",description:"Delete user",enabled:!1,example:'await coreSDK.users.delete("user-id");'}]},{name:"eventsApi",description:"Events Analytics API (disabled)",methods:[{name:"events.getAll",description:"Get all events",enabled:!1,example:"const events = await coreSDK.events.getAll();"},{name:"events.send",description:"Send analytics event",enabled:!1,example:'await coreSDK.events.send({ name: "level_complete", data: { level: 5 } });'}]},{name:"ad",description:"Ad methods",methods:[{name:"showAd",description:"Show ad for a placement",enabled:!0},{name:"initAds",description:"Initialize ads subsystem",enabled:!0},{name:"__setConfigForTests",description:"[DEV] Inject config directly into SDK",enabled:!0},{name:"__setAdsMediatorForTests",description:"[DEV] Inject ad mediator implementation",enabled:!0}]}];function We(i){for(const e of b)for(const t of e.methods)if(t.name===i)return t.enabled;return!1}function Ye(i){return!!b.find(t=>t.name===i)}function Qe(){const i=[];for(const e of b)if(e)for(const t of e.methods)t.enabled&&i.push(t.name);return i}function Xe(i){return b.find(t=>t.name===i)?.methods??[]}function Ze(i,e){for(const t of b)for(const s of t.methods)if(s.name===i){s.enabled=e;return}}typeof window<"u"&&(window.coreSDK=pe),c.AbTestsApiClient=re,c.ApiClient=F,c.AuthApiClient=de,c.AuthModal=j,c.ConfigResult=B,c.ConfigsApiClient=ne,c.CoreSDK=m,c.EventBus=J,c.GoogleAuthHelper=v,c.HealthApiClient=le,c.PlayerKVApiClient=ue,c.RemoteConfigsApiClient=oe,c.SDK_EVENTS=f,c.SDK_METHODS=b,c.SDK_VERSION=A,c.SUPPORTED_VERSIONS=E,c.SegmentsApiClient=ae,c.UsersApiClient=ce,c.coreSDK=pe,c.getEnabledMethods=Qe,c.getMethodsByCategory=Xe,c.isCategoryEnabled=Ye,c.isMethodEnabled=We,c.isVersionSupported=he,c.sdkConfig=h,c.setAuthUrl=I,c.setBaseUrl=K,c.setMethodEnabled=Ze,c.validateVersion=ge,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})}));

</script>
<!-- App entry -->
<script src="js/index.js"></script>

</body>
</html>
